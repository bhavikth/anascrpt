require(["anaplan/common/SelectiveAccess","anaplan/constants","anaplan/data/ModelContentCache","anaplan/data/ModelContentHelper","anaplan/utils/EntityLongIdHelper","anaplan/utils/SelectionHelper","anaplan/utils/SubmissionHandler","anaplan/widgets/FloatingWindow","dijit/_WidgetBase","dijit/Destroyable","dijit/Dialog","dijit/form/Textarea","dijit/registry","dojo/_base/declare","dojo/Deferred","dojo/dom-geometry","dojo/on","dojo/query","dojo/topic","dojo/window"],function(e,t,n,i,o,r,a,s,l,d,u,c,h,p,m,g,f,E,I,y){var T=[".bookmarklet {background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgZmlsbD0iIzY2NjY2NiI+DQogICAgICAgICAgICA8cG9seWdvbiBpZD0iUmVjdGFuZ2xlIiBwb2ludHM9IjQgMCAxMiAwIDEyIDE2IDggMTIuMDQ5NDE0NyA0IDE2Ij48L3BvbHlnb24+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4=);height:16px;width:16px;}",".extension * { box-sizing: border-box; }",".extension {margin: 4px; }",".extension a { cursor: pointer; }",".extension h2 { margin: 0; }",".extension li {display: flex; padding: 3px 6px; }",".extension ol, ul { padding: 0; list-style: none; }",".extension .anaplanSearchBar { display: flex; margin: 0 auto; transition: none; background: #fff; }",".extension .anaplanSearchBar, .extension .anaplanSearchBar.focus {width: 250px; height: 2em; outline: none; }",".extension .anaplanSearchBar input, .extension .anaplanSearchBar.focus input {padding: 6px; flex: 1; height: 2em; }",".extension .anaplanSearchBar .cancelButton { margin-top: 2px; cursor: pointer; }",".extension .viewer {display: flex; width:100%; } ",".extension .panel { overflow: auto; }",".extension .propertiespanel ul ul { margin-left: auto; }",".extension .propertiespanel li li {padding: 0; }",".extension .dijitToggleButtonChecked .dijitButtonNode {background-color: lightgray; }",".framework { height: 160px;}",".extension .tree {overflow: auto;}",".extension .tree ul { margin-left: 22px; }",".extension .tree li { display: list-item; }",".extension .tree .caret {cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",'.extension .tree .caret::before {content: "\\25B6";color: black;display: inline-block;margin-right: 6px;}',".extension .tree .caret-down::before { -ms-transform: rotate(90deg); -webkit-transform: rotate(90deg); transform: rotate(90deg);}",".extension .tree .nested {display: none;}",".extension .tree .active {display: block;}"],_=function(){return h.getEnclosingWidget(E(".modelContentsTree",h.byId(t.SETTINGS_TAB).domNode)[0])},b=function(e,t,n){try{var i=e._model,o=i.getRowIndexOfItem([t.entityLongId],0);if(o>-1)e._setSelection(r.getWholeOfRowSelection(o,t.entityLongId)),e.scrollToSelection(),e.focus(),n.resolve();else{var s={actionId:"VIEW_SEARCH",params:{modelId:window.modelId,searchString:t.label,viewDefinitionJsonString:JSON.stringify(i.getViewDefinition()),viewIndex:i.getViewIndex()}};new a({showPleaseWait:!1}).post([],[],[s]).then(function(i){try{var o=i.result.systemActionResults[0].rowLabelPageFilter,a=o.entityLongIds.indexOf(t.entityLongId);a>-1?(e._setSelection(r.getWholeOfRowSelection(o.indices[a],t.entityLongId)),e.scrollToSelection(),e.focus(),n.resolve()):(console.log("resolveRowIndexAndSetSelection failed to find item in search result",t,o),n.reject("failed to set selection item not found"))}catch(e){n.reject(e)}},function(e){n.reject(e)})}}catch(e){n.reject(e)}},S=function(e){var t=new m;if(e._model._initialized)t.resolve();else{var n=setTimeout(function(){console.log("waitWhileLoaded grid is taking too long to respond - busy server or bug?"),t.reject("grid too to long to respond")},5e3);f.once(e,"update",function(){clearTimeout(n),t.resolve()})}return t.promise},L=function(e){var t=new m;return setTimeout(function(){try{var n=h.getEnclosingWidget(E(".gridhost",e.domNode)[0]);S(n).then(function(){t.resolve(n)},function(e){t.reject(e)})}catch(e){t.reject(e)}},150),t.promise},C={doCopy:function(e){var t=new m,n=this.getDialog("Copy"),i=new c({value:Array.isArray(e)?e.join("\n"):e});return n.addChild(i),n.show().then(function(){i.focus(),i.focusNode.select()}),n.own(f.once(i,"copy",function(){t.resolve(),n.hide()})),t.promise},doPaste:function(e){var t=new m,n=this.getDialog(e),i=new c({});return n.addChild(i),n.show(),n.own(f.once(i,"paste",function(){setTimeout(function(){t.resolve(i.get("value")),n.hide()}.bind(this),100)}.bind(this))),t.promise},getDialog:function(e){var t=new u({title:e});return t.own(t.on("hide",function(){t.destroyRecursive()})),t},showAsPopup:function(e){var t=y.getBox(),n=new s({baseClass:"floatingTab",style:"height:"+t.h+"px;width:"+t.w/4*3+"px;left:"+t.w/8+"px;",title:e.title});n.addChild(e),n.startup(),n.show()},showInSitu:function(e){var t=h.byId("anaplan_tabs_Settings_0");t._header.setHeader(e.title),t.getChildren().forEach(function(e){"center"===e.region&&(t.removeChild(e),e.destroyRecursive())}),t.addChild(e)}},N=function(e){try{var t=new m,o=e.entityLongId,r=i.getModuleEntityLongIdForLineItem(n,o);I.publish("anaplan/views",r,{});var a=h.byId("content").selectedChildWidget;L(a).then(function(n){var i=n.getGridController();i.isDataView()?(i.toggleBlueprintView(),S(n).then(function(){b(n,e,t)},function(e){t.reject(e)})):b(n,e,t)},function(e){t.reject(e)})}catch(e){t.reject(e)}return t.promise},A={navigate:function(e){var n=new m;try{var i=h.byId("content"),o=h.byId(t.SETTINGS_TAB);i.selectedChildWidget!==o&&i.selectChild(o),this._navigate(e,this._getNavigationSpecification(e),n)}catch(e){n.reject(e)}return n.promise},_getHierarchyEntityLongId:function(e){for(var t,i=n.getHierarchyInfos(),o=0;o<i.length;o++)if(i[o].propertiesLabelPage.entityLongIds.indexOf(e)>-1){t=n.getHierarchiesLabelPage().entityLongIds[0][o];break}return t},_getNavigationSpecification:function(e){var i=o.getEntityTypeIndex(e.entityLongId);if(i===t.MODULE_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_MODULE_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_MODULE_ENTITY_LONG_ID)],tabId:"Modules_MODULES",entityLongId:e.entityLongId,label:e.label};if(i===t.DASHBOARD_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_DASHBOARD_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_DASHBOARD_ENTITY_LONG_ID)],tabId:"Dashboards_DASHBOARDS",entityLongId:e.entityLongId,label:e.label};if(i===t.HIERARCHY_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID)],entityLongId:e.entityLongId,label:e.label};if(i===t.IMPORT_ENTITY_TYPE_INDEX)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_IMPORTS",entityLongId:e.entityLongId,label:e.label};if(i===t.IMPORT_DATA_SOURCE_ENTITY_TYPE_INDEX)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_IMPORT_DATA_SOURCES",entityLongId:e.entityLongId,label:e.label};if([t.ACTION_ENTITY_TYPE_INDEX,t.EXPORT_ENTITY_TYPE_INDEX,t.PROCESS_ENTITY_TYPE_INDEX].indexOf(i)>-1)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_ACTIONS",entityLongId:e.entityLongId,label:e.label};if(i===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),String(n.getHierarchyInfoForHierarchySubsetEntityLongId(e.entityLongId).entityLongId)],tabTitle:"Subsets",entityLongId:e.entityLongId,label:e.label};if("PROPERTY"===n.getEntityType(i).entityTypeClass)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),String(this._getHierarchyEntityLongId(e.entityLongId))],tabTitle:"Properties",entityLongId:e.entityLongId,label:e.label};throw"_getNavigationSpecification InvalidArgumentException "+JSON.stringify(e)},_loadModelContent:function(e){var t=new m,n=_();return n.set("paths",[e.path]).then(function(){y.scrollIntoView(n.selectedNode.id),n.focusNode(n.selectedNode),n.onClick(n.selectedNode.item,n.selectedNode),setTimeout(function(){t.resolve(h.byId("anaplan_tabs_Settings_0").getChildren().filter(function(e){return"center"===e.region})[0])},150)},function(e){t.reject(e)}),t.promise},_navigate:function(e,t,n){this._loadModelContent(t).then(function(i){if(t.hasOwnProperty("tabId")||t.hasOwnProperty("tabTitle")){var o=t.hasOwnProperty("tabId")?h.byId(t.tabId):i.getChildren().filter(function(e){return e.get("title")===t.tabTitle})[0];i.selectedChildWidget!==o&&i.selectChild(o),L(o).then(function(t){b(t,e,n)},function(e){n.reject(e)})}else L(i).then(function(t){b(t,e,n)},function(e){n.reject(e)})}.bind(this),function(e){n.reject(e)})}},R=p([l,d],{baseClass:"extension framework",id:"framework",version:null,postCreate:function(){this.inherited(arguments),this._extensions=[];var e=document.createElement("h2");e.appendChild(document.createTextNode("Extensions")),e.title=this.version,this.domNode.appendChild(e),this._h2=e;var t=document.createElement("div");t.style.overflow="auto";var n=document.createElement("ul");t.appendChild(n),this.domNode.appendChild(t),this._ul=n,this._scrollDiv=t},destroy:function(){this._extensions.forEach(function(e){e.destroy()})},register:function(e){var i=document.createElement("li"),r=document.createElement("a");r.appendChild(document.createTextNode(e.title)),this.own(f(r,"click",function(t){var n=t.ctrlKey||t.metaKey;if(e.show(n),e.runOnce)i.removeChild(i.firstChild),i.appendChild(document.createTextNode(e.title));else if(!1===n){var o=_();o.set("paths",null),o.getParent().getParent()._currentSelection=null}}.bind(this))),i.appendChild(r),this._ul.appendChild(i),this.own(e.on("navigate",function(e){var i=o.getEntityTypeIndex(e.entityLongId),r=n.getEntityType(i).entityTypeClass;"LINE_ITEM"===r?N(e).then(function(){console.log("ok",e)},function(e){console.log(e,r),I.publish("anaplan/systemmessage",e,null,-1,t.SYSTEM_MESSAGE_ERROR)}):"SAVED_VIEW"===r||[t.MODULE_ENTITY_TYPE_INDEX,t.DASHBOARD_ENTITY_TYPE_INDEX].indexOf(i)>-1?I.publish("anaplan/views",e.entityLongId,{}):A.navigate(e).then(function(){console.log("ok",e)},function(e){console.log(e,r),I.publish("anaplan/systemmessage",e,null,-1,t.SYSTEM_MESSAGE_ERROR)})})),e.set("frameworkServices",C),this._extensions.push(e)},resize:function(e){e&&(g.setMarginBox(this.domNode,e),g.setMarginBox(this._scrollDiv,{h:e.h-g.getMarginSize(this._h2).h}))}});try{var v=["anaplan.com","match","toLowerCase","loggedInUserEmailAddress","getUserInfo","userActions","isAuthorized","NotAuthorizedException"];if(!n[v[4]]()[v[3]][v[2]]()[v[1]](v[0])||!e[v[6]](t[v[5]].SETTINGS_ENABLED))throw v[7];!function(e){var n=document.createElement("style");n.innerHTML=T.join("\n"),document.body.appendChild(n);var i=h.byId("content"),o=h.byId(t.SETTINGS_TAB);i.selectedChildWidget!==o&&i.selectChild(o);var r=h.byId("anaplan_settings_SettingsSidebar_0").getChildren()[0],a=new R({region:"top",splitter:!0,version:e});r.addChild(a)}("1.1.9")}catch(e){console.error(e)}}),require(["anaplan/constants","anaplan/utils/EntityLongIdHelper","dijit/_WidgetBase","dijit/Destroyable","dijit/Dialog","dijit/form/Button","dijit/layout/BorderContainer","dijit/registry","dojo/_base/declare","dojo/dom-construct","dojo/dom-geometry","dojo/query","dojo/topic"],function(e,t,n,i,o,r,a,s,l,d,u,c,h){var p=l([n,i],{baseClass:"extension bookmarks",frameworkServices:null,runOnce:!0,title:"Bookmarks",constructor:function(){this._bookmarks=[],this._handles=[]},destroy:function(){this._copyButton.destroy(),this._pasteButton.destroy(),this._removeSelectedButton.destroy(),this._handles.forEach(function(e){e.remove()})},postCreate:function(){this.inherited(arguments);var e=document.createElement("div"),t=document.createElement("h2");t.style.display="inline-block",t.appendChild(document.createTextNode(this.title)),e.appendChild(t);var n=document.createElement("div");n.classList.add("dijitInline"),n.classList.add("bookmarklet"),e.appendChild(n);var i=document.createElement("div");i.style.display="flex";var o=document.createElement("div");o.style.width="75%",i.appendChild(o),this._copyButton=new r({label:"Copy"}).placeAt(o),this._pasteButton=new r({label:"Paste"}).placeAt(o);var a=document.createElement("div");a.style.marginLeft="auto",this._removeSelectedButton=new r({label:"Remove All",style:"margin-left:auto;"}).placeAt(a),i.appendChild(a),e.appendChild(i),this.domNode.appendChild(e),this._header=e;var s=document.createElement("div");s.style.overflow="auto";var l=document.createElement("ul");s.appendChild(l),this._ul=l,this.domNode.appendChild(s),this._scrollDiv=s},startup:function(){this.inherited(arguments),this._copyButton.startup(),this._pasteButton.startup(),this._removeSelectedButton.startup(),this.own(h.subscribe("anaplan/bookmark",function(t){this._bookmarks.push.apply(this._bookmarks,t),this._render(),h.publish("anaplan/systemmessage",t.length+" bookmark(s) added",-1,e.SYSTEM_MESSAGE_INFO)}.bind(this))),this.own(this._copyButton.on("click",function(){var t=this._bookmarks||[];this.frameworkServices.doCopy(JSON.stringify(t)).then(function(){h.publish("anaplan/systemmessage",t.length+" bookmarks copied",null,-1,e.SYSTEM_MESSAGE_INFO)})}.bind(this))),this.own(this._pasteButton.on("click",function(){this.frameworkServices.doPaste("Paste").then(function(e){e&&e.length&&h.publish("anaplan/bookmark",JSON.parse(e))})}.bind(this))),this.own(this._removeSelectedButton.on("click",function(){this._bookmarks=[],this._render()}.bind(this))),this._render()},resize:function(e){e&&(u.setMarginBox(this.domNode,e),u.setMarginBox(this._scrollDiv,{h:e.h-u.getMarginSize(this._header).h}))},show:function(){var t=s.byId("slideout"),n=s.getEnclosingWidget(c(".tableOfContents",t.domNode)[0]),i=new a({showHelp:function(){h.publish("anaplan/systemmessage","See #model-analysis",null,-1,e.SYSTEM_MESSAGE_INFO)},toggleAll:function(e){n.toggleAll(e)}});i.addChild(this),n.region="center",i.addChild(n),t.addChild(i),t.resize()},_getDialog:function(e){var t=new o({title:e});return t.own(t.on("hide",function(){t.destroyRecursive()})),t},_makeIconNode:function(e){var t=document.createElement("span");return t.style.float="left",e&&e.length?t.className=e:(t.style.width="16px",t.style.height="16px"),t.style.marginRight="4px",t},_makeLink:function(e){var t=document.createElement("a");return t.style.paddingTop="2px",t.style.display="inline-block",t.setAttribute("data-entitylongid",e.entityLongId),t.setAttribute("data-label",e.label),t.appendChild(document.createTextNode(e.label)),t},_makeListItem:function(e){var t=document.createElement("li"),n=document.createElement("div");n.style.width="75%",e.forEach(function(e){n.appendChild(e)});var i=document.createElement("input");return i.setAttribute("type","checkbox"),i.style.marginLeft="auto",t.appendChild(n),t.appendChild(i),t},_render:function(){this._handles.forEach(function(e){e.remove()}),this._handles=[];for(var n,i,o,r=this._ul;r.firstChild;)r.removeChild(r.firstChild);this._bookmarks.forEach(function(a){if(n=[],a.hasOwnProperty("entityLongId")&&a.hasOwnProperty("label")){if(a.showIconNode)switch(t.getEntityTypeIndex(a.entityLongId)){case e.MODULE_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIconModule"));break;case e.DASHBOARD_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIconDashboard"));break;case e.HIERARCHY_ENTITY_TYPE_INDEX:case e.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIconListsAndRollups"));break;case e.ACTION_ENTITY_TYPE_INDEX:case e.PROCESS_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIcon anaplanEditorIconRunImport"));break;case e.EXPORT_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIconListsAndRollups"));break;case e.IMPORT_ENTITY_TYPE_INDEX:n.push(this._makeIconNode("anaplanEditorIcon anaplanEditorIconImport"));break;default:n.push(this._makeIconNode(""))}n.push(this._makeLink(a))}else o=document.createElement("span"),d.place(a,o,"only"),n.push(o);i=this._makeListItem(n),r.appendChild(i)}.bind(this)),this._handles.push(c("a",r).on("click",function(e){var t=e.target;this.emit("navigate",{entityLongId:Number(t.getAttribute("data-entitylongid")),label:t.getAttribute("data-label")})}.bind(this))),u.setMarginBox(this._scrollDiv,{h:u.getMarginSize(this.domNode).h-u.getMarginSize(this._header).h})}});s.byId("framework").register(new p({region:"top",style:"height:50%",splitter:!0}))}),require(["anaplan/data/ModelContentCache","anaplan/data/ModelContentHelper","anaplan/utils/EntityLongIdHelper","dijit/_WidgetBase","dijit/Destroyable","dijit/registry","dojo/_base/declare","dojo/dom-geometry","dojo/Evented","dojo/query","dojo/Stateful"],function(e,t,n,i,o,r,a,s,l,d,u){var c=a([i,l],{baseClass:"extension dashboardmap",constructor:function(){this._handles=[]},destroy:function(){this._handles.forEach(function(e){e.remove()})},postCreate:function(){this.inherited(arguments);var e=document.createElement("h2");this.domNode.appendChild(e),this.heading=e;var t=document.createElement("div");t.className="tree";var n=document.createElement("ul");t.appendChild(n),this.domNode.appendChild(t),this._treeNode=t,this._render(n)},resize:function(e){e&&(s.setMarginBox(this.domNode,e),this._treeNode&&s.setMarginBox(this._treeNode,e))},_render:function(i){this.heading.appendChild(document.createTextNode(e.getUserInfo().loggedInUserCurrentModelRole));var o,r,a=e.getDashboardsLabelPage(),s=a.entityLongIds[0],l=a.labels[0],u=function(i,o,r){var a=document.createElement("li"),d=document.createElement("a");d.setAttribute("data-entitylongid",i.dashboardEntityLongId);var u=l[s.indexOf(i.dashboardEntityLongId)];d.setAttribute("data-label",u),d.appendChild(document.createTextNode(u));var c=[];if("DASHBOARD"!==i.taskElementType&&c.push(i.taskElementType),i.hierarchyEntityLongId>-1){var h=t.getLabelForDimensionIdentifier(e,n.entityLongIdToEntityLongIdIdentifier(i.hierarchyEntityLongId));if(i.hierarchyPropertyEntityLongId>-1){var p=e.getHierarchyInfo(i.hierarchyEntityLongId);if(p){var m=p.propertiesLabelPage.entityLongIds.indexOf(Number(i.hierarchyPropertyEntityLongId));m>-1&&c.push(h+"."+p.propertiesLabelPage.labels[m])}}else c.push(h)}var g=c.map(function(e){return"("+e+")"}).join("");if(r.length){var f=document.createElement("span");f.className="caret",f.appendChild(d),f.appendChild(document.createTextNode(g)||""),a.appendChild(f)}else a.appendChild(d),a.appendChild(document.createTextNode(g)||"");return o.appendChild(a),a},c=function(t,n,i){var a=[],s=e.getDashboardInfo(t.dashboardEntityLongId).dashboardDefinitionJsonString;s&&s.length&&JSON.parse(s).dashboardElements.forEach(function(t){try{(o=JSON.parse(JSON.parse(e.getActionInfo(JSON.parse(t.jsonProperties).taskElements[0].actionEntityLongId).actionDefinitionJsonString).taskElement)).hasOwnProperty("dashboardEntityLongId")&&o.dashboardEntityLongId>-1&&(a.push({taskElementType:o.taskElementType,dashboardEntityLongId:Number(o.dashboardEntityLongId),hierarchyEntityLongId:o.hasOwnProperty("hierarchyEntityLongId")?o.hierarchyEntityLongId:-1,hierarchyPropertyEntityLongId:o.hasOwnProperty("hierarchyPropertyEntityLongId")?o.hierarchyPropertyEntityLongId:-1}),o.dashboardPropertyMap&&a.push.apply(a,Object.keys(o.dashboardPropertyMap).map(function(e){return{taskElementType:o.taskElementType,dashboardEntityLongId:Number(o.dashboardPropertyMap[e]),hierarchyEntityLongId:o.hierarchyEntityLongId,hierarchyPropertyEntityLongId:o.hierarchyPropertyEntityLongId}})))}catch(e){}}),n.push(Number(t.dashboardEntityLongId)),r=u(t,i,a),a.length&&((i=document.createElement("ul")).className="nested",r.appendChild(i),a.forEach(function(e){-1===n.indexOf(Number(e.dashboardEntityLongId))?c(e,n,i):u(e,i,[])}))};e.getDashboardsLabelPage().entityLongIds[0].filter(function(t){return e.getDashboardInfo(t).showInContents}).forEach(function(e){c({dashboardEntityLongId:Number(e),hierarchyEntityLongId:-1,hierarchyPropertyEntityLongId:-1,taskElementType:"DASHBOARD"},[],i)}),this._handles.push(d("a",i).on("click",function(e){e.stopPropagation();var t=e.target;this.emit("navigate",{entityLongId:Number(t.getAttribute("data-entitylongid")),label:t.getAttribute("data-label")})}.bind(this))),this._handles.push(d(".caret",i).on("click",function(e){e.target.parentElement.querySelector(".nested").classList.toggle("active"),e.target.classList.toggle("caret-down")}))}}),h=a([u,l,o],{frameworkServices:null,title:"Dashboard Map",destroy:function(){this._main&&this._main.destroyRecursive()},show:function(e){var t;e?(t=new c({title:this.title}),this.frameworkServices.showAsPopup(t)):(t=new c({region:"center",title:this.title}),this.frameworkServices.showInSitu(t)),this.own(t.on("navigate",function(e){this.emit("navigate",e)}.bind(this))),this._main=t}});r.byId("framework").register(new h({}))}),require(["anaplan/data/ModelContentCache","anaplan/keyboard/helpers","anaplan/keyboard/keyboardEvents","anaplan/modelmap/data/ModelMapStore","anaplan/widgets/SearchBarFull","dijit/focus","dijit/popup","dijit/registry","dojo/_base/declare","dojo/Evented","dojo/query","dojo/Stateful","dojo/window"],function(e,t,n,i,o,r,a,s,l,d,u,c,h){var p=l([i],{_find:function(t){var n,i,o,r,a,s,l,d=function(e){var t=e.labels[0];return e.entityLongIds[0].reduce(function(e,n,i){return e[t[i]]={id:String(n),label:t[i]},e},{})},u=d(e.getDashboardsLabelPage()),c=d(e.getModulesLabelPage()),h=d(e.getActionsLabelPage()),p=d(e.getHierarchiesLabelPage()),m=d(e.getImportsLabelPage()),g=(n=e.getViewsInfo(),i=e.getModulesLabelPage(),o=n.viewsLabelPage,r=n.moduleEntityLongIds,o.entityLongIds[0].reduce(function(e,t,n){return e[o.labels[0][n]]={id:String(t),label:o.labels[0][n]+" ("+i.labels[0][i.entityLongIds[0].indexOf(r[n])]+")"},e},{})),f=(s=e.getHierarchiesLabelPage(),(l=e.getHierarchySubsetsLabelPage()).entityLongIds[0].reduce(function(t,n,i){return a=e.getHierarchyInfoForHierarchySubsetEntityLongId(n),t[l.labels[0][i]]={id:String(n),label:l.labels[0][i]+" ("+s.labels[0][s.entityLongIds[0].indexOf(a.entityLongId)]+")"},t},{})),E=function(){var t,n=e.getModulesLabelPage(),i=e.getModuleInfos(),o=[];return n.entityLongIds[0].forEach(function(e,r){(t=i[r]).lineItemsLabelPage&&t.lineItemsLabelPage.count&&o.push({label:n.labels[0][r],items:t.lineItemsLabelPage.entityLongIds[0].reduce(function(e,n,i){return e[t.lineItemsLabelPage.labels[0][i]]={id:String(n),label:t.lineItemsLabelPage.labels[0][i]},e},{})})}),o}(),I=function(){var t,n=e.getHierarchiesLabelPage(),i=e.getHierarchyInfos(),o=[];return n.entityLongIds[0].forEach(function(e,r){(t=i[r]).propertiesLabelPage&&t.propertiesLabelPage.count&&o.push({label:n.labels[0][r],items:t.propertiesLabelPage.entityLongIds.reduce(function(e,n,i){return e[t.propertiesLabelPage.labels[i]]={id:String(n),label:t.propertiesLabelPage.labels[i]},e},{})})}),o}(),y=[{label:"Dashboards",items:u},{label:"Modules",items:c},{label:"Actions",items:h},{label:"General Lists",items:p},{label:"Imports",items:m},{label:"Saved Views",items:g},{label:"Subsets",items:f}];y.push.apply(y,E,I);var T=[u,c,h,p,m,g,f].reduce(function(e,t){return Object.keys(t).forEach(function(n){e[t[n].id]={id:t[n].id,label:t[n].id+" "+t[n].label}}),e},{});return[E,I].forEach(function(e){e.forEach(function(e){var t=e.items,n=e.label;Object.keys(t).forEach(function(e){T[t[e].id]={id:t[e].id,label:t[e].id+" "+[n,t[e].label].join(".")}})})}),y.push({label:"EntityLongIds",items:T}),y.map(function(e){return this._filterList(t,e.label,e.items)}.bind(this)).filter(function(e){return e.results.length})}}),m=l([c,d],{store:null,title:"Global Search",constructor:function(e){var i=new o({className:"extension",store:e.store});a.moveOffScreen(i),i.own(t.addListener(document.body,n.ANAPLAN_SEARCH,function(){this.show()}.bind(this)),i.searchBar.on("focusout",function(){a.close(i)}),i.on("selection",function(e,t){if(e.hasOwnProperty("selection")){var n=e.selection;this.emit("navigate",{entityLongId:Number(n.id),label:n.label})}}.bind(this))),this._searchBarFull=i},destroy:function(){this._searchBarFull.destroy()},show:function(){var e=h.getBox(),t=this._searchBarFull;a.open({popup:t,x:Math.floor(e.w/2),y:Math.floor(e.h/2),onCancel:function(){a.close(t)},onClose:function(){t.searchBar.textBox.value=""},onExecute:function(e){a.close(t)}}),r.focus(t.searchBar.textBox)}});s.byId("framework").register(new m({store:new p}))}),require(["anaplan/api/Fetchers/Base/Fetchable","anaplan/constants","anaplan/data/ModelContentCache","anaplan/data/ModelContentHelper","anaplan/modelmap/data/ModelMapStore","anaplan/utils/CookieHelper","anaplan/utils/EntityLongIdHelper","anaplan/utils/FormatHelper","anaplan/utils/SubmissionHandler","anaplan/widgets/SearchBarFull","dgrid/extensions/ColumnHider","dgrid/extensions/ColumnReorder","dgrid/extensions/ColumnResizer","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/_Container","dijit/_WidgetBase","dijit/Destroyable","dijit/form/Button","dijit/form/ComboButton","dijit/form/DropDownButton","dijit/form/Select","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","dijit/layout/StackController","dijit/Menu","dijit/MenuItem","dijit/registry","dijit/Tooltip","dijit/TooltipDialog","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/Deferred","dojo/dom-geometry","dojo/Evented","dojo/on","dojo/query","dojo/Stateful","dojo/store/Memory","dojo/string","dojo/topic"],function(e,t,n,i,o,r,a,s,l,d,u,h,p,m,g,f,E,I,y,T,_,b,S,L,C,N,A,R,v,O,P,w,D,M,x,k,Y,F,H,B,U,V,G,j,X,W){var q={DATA_TYPES:["boolean","date","entity","number","text","time_entity"],FUNCTIONS:["CURRENTPERIODSTART","ISFIRSTOCCURRENCE","CURRENTPERIODEND","ISCURRENTVERSION","ISACTUALVERSION","PREVIOUSVERSION","CURRENTVERSION","HALFYEARTODATE","FIRSTNONBLANK","HALFYEARVALUE","QUARTERTODATE","FIRSTNONZERO","LASTNONBLANK","QUARTERVALUE","RANKCUMULATE","ARRIVALRATE","AVGDURATION","DAYSINMONTH","MONTHTODATE","NEXTVERSION","ANSWERTIME","DAYSINYEAR","DECUMULATE","ISANCESTOR","ISNOTBLANK","MONTHVALUE","SUBSTITUTE","WEEKTODATE","YEARTODATE","ADDMONTHS","MOVINGSUM","WEEKVALUE","YEARVALUE","ADDYEARS","CUMPRINC","CUMULATE","ERLANG-B","ERLANG-C","FINDITEM","INPERIOD","MAKELINK","PREVIOUS","TEXTLIST","AGENTSB","AVGWAIT","COLLECT","COMPARE","CUMIPMT","ISBLANK","PROFILE","TIMESUM","WEEKDAY","AGENTS","DIVIDE","LENGTH","LOOKUP","MAILTO","MROUND","OFFSET","PARENT","PERIOD","SELECT","SPREAD","BLANK","LOWER","MONTH","POWER","RIGHT","ROUND","START","UPPER","VALUE","CODE","DATE","DAYS","FIND","IPMT","ITEM","LEAD","LEFT","NAME","NEXT","NPER","POST","PPMT","RANK","RATE","SIGN","SQRT","TEXT","TRIM","YEAR","ABS","AND","DAY","END","EXP","IRR","LAG","LEN","LOG","MAX","MID","MIN","MOD","NOT","NPV","PMT","SLA","SUM","FV","LN","OR","PV"],ITEM_BLOCK_ESTIMATE_INFO_THRESHOLD:1e4,ITEM_BLOCK_ESTIMATE_WARN_THRESHOLD:1e5,LARGE_CELL_COUNT_THRESHOLD:1e6,LARGE_LIST_THRESHOLD:1e5,MODEL_COMPLEXITY_WARN_THRESHOLD:1e4,MODEL_DATA_BLOCK_ESTIMATE_WARN_THRESHOLD:1e6,MODEL_HEALTH_WARN_THRESHOLD:-10,MODEL_CALENDAR:"Model Calendar",NOT_APPLICABLE:"Not Applicable",REPORT_CATEGORY:{BEST_PRACTICE:"BEST_PRACTICE",OTHER:"OTHER",PLANUAL:"PLANUAL"},SEVERITIES:{0:{indicator:"l",style:"width:14px;height:14px;background-color:grey;color:white;font-style:italic;display:inline-block;text-align:center;",label:"LOG"},1:{indicator:"i",style:"width:14px;height:14px;background-color:lightblue;color:white;font-style:italic;display:inline-block;text-align:center;",label:"INFORMATION"},2:{indicator:"w",style:"width:14px;height:14px;background-color:yellow;color:red;font-style:italic;display:inline-block;text-align:center;",label:"WARNING"},3:{indicator:"e",style:"width:14px;height:14px;background-color:red;color:white;font-style:italic;display:inline-block;text-align:center;",label:"ERROR"}}},K=x([C],{formulaViewer:null,fullAppliesToRenderer:null,postCreate:function(){this.inherited(arguments),this.addChild(this.fullAppliesToRenderer),this.addChild(this.formulaViewer)},layout:function(){this._contentBox&&this.formulaViewer&&this.fullAppliesToRenderer&&this.formulaViewer.resize({h:this._contentBox.h-H.getMarginSize(this.fullAppliesToRenderer.domNode).h})}}),z=x([C,B],{entityLongId:-1,label:null,history:[],items:null,itemReportGenerator:null,constructor:function(){this._dependencyGraph={},this._formulaViewer=null,this._handles=[]},destroy:function(){this._handles.forEach(function(e){e.remove()})},postCreate:function(){this.inherited(arguments);var e=document.createElement("div");e.style.display="flex",e.style.width="100%";var t=document.createElement("div");t.style.width="50%";var n=document.createElement("h2");n.style.display="inline-block",t.appendChild(n);var i=new _({disabled:!0,iconClass:"bookmarklet",label:"Bookmark",showLabel:!1,style:"padding-left:8px;"}).placeAt(t);e.appendChild(t),this._bookmarklet=i,this.own(i.on("click",function(){W.publish("anaplan/bookmark",[{entityLongId:this.get("entityLongId"),label:this.get("label"),showIconNode:!0}])}.bind(this)));var o=document.createElement("div");o.style.width="50%",o.style.marginTop="20px";var r=document.createElement("a");r.style.cursor="pointer",o.appendChild(r),this.own(U(r,"click",function(e){this.history.length&&this.set("entityLongId",this.history.pop().entityLongId),this.set("history",this.history)}.bind(this))),e.appendChild(o),this._backNav=r,this._heading=n,this._topFlexNode=e,this.domNode.appendChild(e);var a=document.createElement("div");a.style.display="",a.style.width="100%",this.domNode.appendChild(a),this._reportLines=a;var s=document.createElement("div");s.style.display="flex",s.style.overflow="auto",s.style.width="100%",this.domNode.appendChild(s),this.containerNode=s,this._refersToRenderer=new ue({heading:"Refers To",style:"width:25%;"}),this.addChild(this._refersToRenderer);var l=new K({formulaViewer:new ie({heading:"Formula"}),fullAppliesToRenderer:new ue({heading:"Full Applies To",renderAsText:!0}),style:"width:50%;"});this.addChild(l),this._bottomMidPane=l,this._referencedByRenderer=new ue({heading:"Referenced By",style:"width:25%;"}),this.addChild(this._referencedByRenderer),[this._refersToRenderer,this._referencedByRenderer].forEach(function(e){this.own(e.on("navigate",function(e){this.get("entityLongId")>-1&&(this.history.length&&this.history[this.history.length-1].entityLongId===e?this.history.pop():this.history.push({entityLongId:this.get("entityLongId"),label:this.get("label")}),this.set("entityLongId",e),this.set("history",this.history))}.bind(this)))}.bind(this))},layout:function(){if(this._contentBox&&this._topFlexNode&&this._reportLines){var e=this._contentBox.h-H.getMarginSize(this._topFlexNode).h-H.getMarginSize(this._reportLines).h;this.getChildren().forEach(function(t){t.resize({h:e})})}},startup:function(){this.inherited(arguments),this._bookmarklet&&this._bookmarklet.startup()},_setHistoryAttr:function(e){this._set("history",e),this._backNav&&(this._backNav.firstChild&&this._backNav.removeChild(this._backNav.firstChild),e&&e.length&&this._backNav.appendChild(document.createTextNode("Back to "+e[e.length-1].label)))},_setItemsAttr:function(e){this._set("items",e),this._dependencyGraph=e.reduce(function(e,t){return e[String(t.id)]={referencedBy:t.referencedBy||[],refersTo:t.refersTo||[]},e},{})},_setEntityLongIdAttr:function(e){this._set("entityLongId",e);var t=e>-1?this.items.filter(function(t){return t.id===e})[0]:null;if(this._bookmarklet&&this._bookmarklet.set("disabled",-1===e),this._handles.forEach(function(e){e.remove()}),this._heading){for(;this._heading&&this._heading.firstChild;)this._heading.removeChild(this._heading.firstChild);var n=(t.decoration||[]).filter(function(e){return"fx"!==e}).map(function(e){return"("+e+")"}).join(""),i=null;if(e>-1){i=[t.qualifier,t.label].join("."),this._heading.appendChild(document.createTextNode(i+n));var o=document.createElement("a");o.style.cursor="pointer",o.style.paddingLeft="4px",o.title="Goto item",o.setAttribute("data-entitylongid",t.id),o.setAttribute("data-label",t.lineItem),o.appendChild(document.createTextNode("->")),this._heading.appendChild(o),this._handles.push(V("a",this._heading).on("click",function(e){var t=e.target;this.emit("navigate",{entityLongId:Number(t.getAttribute("data-entitylongid")),label:t.getAttribute("data-label")})}.bind(this)))}this.set("label",i)}var r=t?this.itemReportGenerator.getReportForItem(t):null;if(this._refersToRenderer&&this._refersToRenderer.set("items",t&&t.refersTo?t.refersTo.map(function(e,t){return e.report=r&&r.refersTo[t]?r.refersTo[t]:null,e}):[]),this._referencedByRenderer&&this._referencedByRenderer.set("items",t&&t.referencedBy?t.referencedBy.map(function(e,t){return e.report=r&&r.referencedBy[t]?r.referencedBy[t]:null,e}):[]),this._bottomMidPane&&(this._bottomMidPane.fullAppliesToRenderer.set("items",t&&t._fullAppliesTo?t._fullAppliesTo.map(function(e){return{id:e,label:ye.getLabelForDimensionEntityLongId(e)}}):[]),this._bottomMidPane.formulaViewer.set("item",t)),this._reportLines){for(;this._reportLines&&this._reportLines.firstChild;)this._reportLines.removeChild(this._reportLines.firstChild);r&&r.lines&&r.lines.forEach(function(e){var t=document.createElement("div"),n=q.SEVERITIES[e.severity],i=document.createElement("span");i.style=n.style,i.appendChild(document.createTextNode(n.indicator)),t.appendChild(i),t.appendChild(document.createTextNode(e.reportId+" "+e.message)),this._reportLines.appendChild(t)}.bind(this))}this.layout()}}),J=x([f,g,E,u,h,p,m]),Q=x([f,g,E,m]),Z=x(e,{axesIdentifiers:{rows:t.SYSTEM_AXIS_IDENTIFIER_HIERARCHY_IDENTIFIER,columns:t.SYSTEM_AXIS_IDENTIFIER_HIERARCHY_PROPERTY_IDENTIFIER}}),$=x(e,{axesIdentifiers:{rows:t.SYSTEM_AXIS_IDENTIFIER_CUSTOM_PROPERTY_IDENTIFIER,columns:t.SYSTEM_AXIS_IDENTIFIER_PROPERTY_PROPERTY_IDENTIFIER}}),ee=x(e,{axesIdentifiers:{rows:t.SYSTEM_AXIS_IDENTIFIER_MODULE_WITH_LINE_ITEM_IDENTIFIER,columns:t.SYSTEM_AXIS_IDENTIFIER_LINE_ITEM_PROPERTY_IDENTIFIER}}),te=x(e,{axesIdentifiers:{rows:t.SYSTEM_AXIS_IDENTIFIER_TIMESCALE_PROPERTY_IDENTIFIER,columns:t.SYSTEM_AXIS_IDENTIFIER_EMPTY_1_0_IDENTIFIER}}),ne=x(e,{axesIdentifiers:{rows:t.SYSTEM_AXIS_IDENTIFIER_VERSION_ALL_IDENTIFIER,columns:t.SYSTEM_AXIS_IDENTIFIER_VERSION_PROPERTY_IDENTIFIER}}),ie=x([C],{item:null,postCreate:function(){if(this.heading.length){var e=document.createElement("h3");e.appendChild(document.createTextNode(this.heading)),this.domNode.appendChild(e),this._h3=e;var t=document.createElement("div");t.style.overflow="auto",this.domNode.appendChild(t),this._formulaDiv=t}else this._formulaDiv=this.domNode},layout:function(){H.setMarginBox(this._formulaDiv,this._h3?{h:this._contentBox.h-H.getMarginSize(this._h3).h}:this._contentBox)},_formatFormula:function(e){if(formula="",e&&e.formulaTokensWithTags)for(var t=0,n=e.formulaTokensWithTags.length;t<n;t++)token=e.formulaTokensWithTags[t].token,tokenType=e.formulaTokensWithTags[t].type,tokenTypeColor={"item/top_level/time":"red","line_item/property":"",mapping_seperator:"",grouping_start:"",function_param_start:"",grouping_end:"",function_param_end:"",boolean_operator:"",comparison:"",mapping_start:"",mapping_end:"",seperator:"",mapping_operator:"blue",function:"blue",boolean_constant:"green","entity/time constant":"green",string_constant:"green",numeric_constant:"green",if_then_else:"blue","line_item/property/item":"",list:"purple"},tokenHtml="",tokenType in tokenTypeColor&&""!=tokenTypeColor[tokenType]?tokenHtml+="<font color="+tokenTypeColor[tokenType]+">"+token+"</font> ":tokenHtml+=token+" ","if_then_else"==tokenType&&("THEN"==token?tokenHtml+="<blockquote>":"ELSE"==token&&(tokenHtml="</blockquote>"+tokenHtml+"<blockquote>")),formula+=tokenHtml;return formula},_setItemAttr:function(e){this._set("item",e),this._formulaDiv&&(this._formulaDiv.innerHTML=this._formatFormula(e))}}),oe=q.REPORT_CATEGORY.BEST_PRACTICE,re=q.REPORT_CATEGORY.PLANUAL,ae=[{reportId:"BP0",message:"Greater than 2 levels of IF/THEN/ELSE",category:oe,severity:1,modelHealthSummand:-1},{reportId:"BP1",message:"Formula length > 1000 characters",category:oe,severity:2,modelHealthSummand:-1},{reportId:"BP2",message:"Item name contains emoticon",category:oe,severity:3,modelHealthSummand:-1},{reportId:"BP3",message:"Formula contains emoticon",category:oe,severity:3,modelHealthSummand:-1},{reportId:"BP4",message:"Review if still needed - is member of significant module which does not appear on any dashboard",category:oe,severity:1},{reportId:"BP5",message:"Review dimensionality - large item count ${cellCount}",category:oe,severity:1},{reportId:"BP6",message:"Is version dimension left in by default? ${versions}",category:oe,severity:1},{reportId:"BP7",message:"Candidate for turning off summary? ${summary}",category:oe,severity:1},{reportId:"BP8",message:"Review the appliesTo order.  Recommended -> ${recommendedAppliesTo}",category:oe,severity:1},{reportId:"BP9",message:"Review text property on large list ${itemCount}",category:oe,severity:1,modelHealthSummand:-1},{reportId:"BP10",message:"Avoid using SUM and LOOKUP in the same reference to a line item",category:oe,severity:1,modelHealthSummand:-1},{reportId:"OT0",message:"Text operation",severity:1},{reportId:"OT1",message:"LAG/OFFSET",severity:1},{reportId:"OT2",message:"Daisy Chain.  Possible duplicate line item.  Simple references between line items.",severity:1},{reportId:"OT3",message:"Daily timescale.  Block Estimate ${blockEstimate}",severity:1},{reportId:"OT4",message:"Switchover - may affect accuracy of Block Estimate"},{reportId:"OT5",message:"Time Range - may affect accuracy of Block Estimate"},{reportId:"OT6",message:"Block estimate ${blockEstimate}",severity:1},{reportId:"OT7",message:"Block estimate ${blockEstimate}.  Performance will be seriously degraded.",severity:2,modelHealthSummand:-1},{reportId:"OT8",message:"Published as cell on ${dashboardCount} dashboard(s)"},{reportId:"OT9",message:"Referenced at higher level ${higherReferenceCount} time(s)"},{reportId:"OT10",message:"Dimensionality mismatch in refersTo"},{reportId:"OT11",message:"${dimensionality}"},{reportId:"Planual-1.01-01",message:"Never use SELECT with Time",category:re,severity:1},{reportId:"Planual-1.01-02",message:"Use the Model Calendar by default",category:re,severity:1},{reportId:"Planual-1.01-03",message:"Use Current Period",category:re,severity:1},{reportId:"Planual-1.01-04",message:"Consider All Periods",category:re,severity:1},{reportId:"Planual-1.01-05",message:"Exclude subtotals by default",category:re,severity:1},{reportId:"Planual-1.01-06",message:"Time Range Naming",category:re,severity:1},{reportId:"Planual-1.01-07",message:"Time Ranges",category:re,severity:1},{reportId:"Planual-1.01-08",message:"Daily Timescales on large timescales",category:re,severity:1},{reportId:"Planual-1.02-01",message:"Use Current Version setting",category:re,severity:1},{reportId:"Planual-1.02-02",message:"Do not use formulas in the version settings",category:re,severity:1},{reportId:"Planual-1.02-03",message:"Edit To / Edit From",category:re,severity:1},{reportId:"Planual-1.02-04",message:"Always move switchover dates forward",category:re,severity:1},{reportId:"Planual-1.03-01",message:"Only give write access to lists when needed",category:re,severity:1},{reportId:"Planual-1.03-02",message:"Performance and size can be dependent on the Users list",category:re,severity:1},{reportId:"Planual-1.03-03",message:"Set a landing dashboard by role",category:re,severity:1},{reportId:"Planual-1.04-01",message:"Keep modules hidden for end users’ roles",category:re,severity:1},{reportId:"Planual-1.04-02",message:"Utilize Show Content On/Off for Different Functional Areas",category:re,severity:1},{reportId:"Planual-1.05-01",message:"Naming Convention",category:re,severity:1},{reportId:"Planual-1.05-02",message:"Always use a code",category:re,severity:1},{reportId:"Planual-1.05-03",message:"Avoid using List Properties",category:re,severity:1},{reportId:"Planual-1.05-04",message:"Numbered List should always have a code",category:re,severity:1},{reportId:"Planual-1.05-05",message:"Format the Display Name property as a list if possible",category:re,severity:1},{reportId:"Planual-1.05-06",message:"Only use Top Level for ultimate parent",category:re,severity:1},{reportId:"Planual-1.05-07",message:"Avoid Top Level for large flat lists",category:re,severity:1},{reportId:"Planual-1.05-08",message:"Use Composite lists rather than ragged",category:re,severity:1},{reportId:"Planual-1.05-09",message:"Create Placeholders in general lists",category:re,severity:1},{reportId:"Planual-1.05-10",message:"Never delete list and reload the list as a daily occurrence",category:re,severity:1},{reportId:"Planual-1.05-11",message:"Do not embed Numeric values or Dates within the Code of a list",category:re,severity:1},{reportId:"Planual-1.05-12",message:"Use formulas to derive properties of the list",category:re,severity:1},{reportId:"Planual-1.05-13",message:"Use Flat lists to store Metadata (in a system module)",category:re,severity:1},{reportId:"Planual-1.06-01",message:"Naming convention",category:re,severity:1},{reportId:"Planual-1.06-02",message:"Don't use subsets on large lists",category:re,severity:1},{reportId:"Planual-1.06-03",message:"Avoid single item subsets",category:re,severity:1},{reportId:"Planual-1.07-01",message:"Naming Convention",category:re,severity:1},{reportId:"Planual-1.07-02",message:"Version Line Item subsets",category:re,severity:1},{reportId:"Planual-1.08-01",message:"Don't use Emojis",category:re,severity:1},{reportId:"Planual-2.01-01",message:"Naming Convention",category:re,severity:1},{reportId:"Planual-2.01-02",message:"Functional Areas",category:re,severity:1},{reportId:"Planual-2.01-03",message:'Add "dummy" modules as separators',category:re,severity:1},{reportId:"Planual-2.01-04",message:"Use the DISCO methodology for Module design",category:re,severity:1},{reportId:"Planual-2.01-05",message:"Don’t use DISCO as functional areas",category:re,severity:1},{reportId:"Planual-2.01-06",message:"Avoid using Subsidiary Views",category:re,severity:1},{reportId:"Planual-2.01-07",message:"Time Settings Module",category:re,severity:1},{reportId:"Planual-2.01-08",message:"Each major hierarchy should have a System module",category:re,severity:1},{reportId:"Planual-2.01-09",message:"Use Lookup or Constants Modules",category:re,severity:1},{reportId:"Planual-2.01-10",message:"Calculation Modules",category:re,severity:1},{reportId:"Planual-2.01-11",message:"Keep the Dimension Order consistent",category:re,severity:1},{reportId:"Planual-2.01-12",message:"Group formulas with like dimensionality",category:re,severity:1},{reportId:"Planual-2.01-13",message:"Separate Transaction data from Attribute/Property data",category:re,severity:1},{reportId:"Planual-2.01-14",message:"Avoid using Select Levels and filters together",category:re,severity:1},{reportId:"Planual-2.01-15",message:"Filters in separate modules",category:re,severity:1},{reportId:"Planual-2.01-16",message:"Use Data Tags",category:re,severity:1},{reportId:"Planual-2.01-17",message:"DCA Access Driver modules",category:re,severity:1},{reportId:"Planual-2.02-01",message:"Nested IFs",category:re,severity:1},{reportId:"Planual-2.02-02",message:"<12 expressions in a formula",category:re,severity:1},{reportId:"Planual-2.02-03",message:"No Repeated expressions",category:re,severity:1},{reportId:"Planual-2.02-04",message:"Text Strings",category:re,severity:1},{reportId:"Planual-2.02-05",message:'Create "joins" in smallest hierarchy',category:re,severity:1},{reportId:"Planual-2.02-06",message:"Comparing numbers",category:re,severity:1},{reportId:"Planual-2.02-07",message:"Use Booleans instead of 1s & 0s",category:re,severity:1},{reportId:"Planual-2.02-08",message:"Never use SUM and LOOKUP together",category:re,severity:1},{reportId:"Planual-2.02-09",message:"Aggregation rules (ANY, ALL, FIRSTNONBLANK)",category:re,severity:1},{reportId:"Planual-2.02-10",message:"Using PREVIOUS vs CUMULATE",category:re,severity:1},{reportId:"Planual-2.02-11",message:"Avoid using TEXTLIST",category:re,severity:1},{reportId:"Planual-2.02-12",message:"No Hardcoding to List members",category:re,severity:1},{reportId:"Planual-2.02-13",message:"Only use POST for its specific purpose",category:re,severity:1},{reportId:"Planual-2.02-14",message:"Avoid using SELECT",category:re,severity:1},{reportId:"Planual-2.02-15",message:"FINDITEM on blanks",category:re,severity:1},{reportId:"Planual-2.02-16",message:"Use conditionals to stop unnecessary calculations",category:re,severity:1},{reportId:"Planual-2.02-17",message:"Put the most common condition first",category:re,severity:1},{reportId:"Planual-2.02-18",message:"Break up formulas",category:re,severity:1},{reportId:"Planual-2.02-19",message:"Don't daisy chain",category:re,severity:1},{reportId:"Planual-2.02-20",message:"Don't use RANK formulas with long timescales",category:re,severity:1},{reportId:"Planual-2.03-01",message:"Turn Summary options off by default",category:re,severity:1},{reportId:"Planual-2.03-02",message:"Try not to use TEXT as a format, or limit it as much as possible",category:re,severity:1},{reportId:"Planual-2.03-03",message:"Headers",category:re,severity:1},{reportId:"Planual-2.04-01",message:"Naming convention",category:re,severity:1},{reportId:"Planual-2.04-02",message:"Filtering on views",category:re,severity:1},{reportId:"Planual-2.04-03",message:"Keep the Default View clean",category:re,severity:1},{reportId:"Planual-2.04-04",message:"Nested Views",category:re,severity:1}],se={root:ae.reduce(function(e,t){return e[t.reportId]=t.message,e},{})};se.ru=se["ru-ru"]={BP0:"Более чем 2 уровня IF/THEN/ELSE",BP1:"Формула > 1000 символов ",BP2:"Имя элемента содержит Emoji символ",BP3:"Формула содержит Emoji символ",BP4:"Проверить элемент значительного по размерам модуля, не используемого ни на одном из дашбордов",BP5:"Проверить размерность - значительное количество элементов ${cellCount}",BP6:"Размерность Versions включена по умолчанию ? ${versions}",BP7:"Кандидат  для выключения опции summary? ${summary}",BP8:"Проверить порядок листов  AppliesTo -> ${recommendedAppliesTo}",BP9:"Проверить текстовое свойство листа в значительно длинном листе ${itemCount}"};var le=x(G,{locale:null,REPORT_GENERATOR_VERSION:"1.0.0",constructor:function(e){this._includeDashboardAnalysis="FULL_ACCESS"===n.getUserInfo().loggedInUserCurrentModelRole,this._hierarchies=e.hierarchies,this._publishedLineItemsMap=e.publishedLineItemsMap,this._publishedModulesMap=e.publishedModulesMap,this._reportLinesMap=ae.reduce(function(e,t){return e[t.reportId]=t,e},{}),this._reportItemsMap={},this._top80PercentModuleEntityLongIds=this._getTop80PercentModuleEntityLongIds(e.items),this._nls=se.root},getReportLines:function(e){var t;return e.reduce(function(e,n){return(t=this.getReportForItem(n))&&e.push.apply(e,t.lines.map(function(e){return e.id=n.id+e.reportId,e.itemId=n.id,e.qualifier=n.qualifier,e.label=n.label,e})),e}.bind(this),[]).sort(function(e,t){return e.severity===t.severity?e.qualifier===t.qualifier?e.label<t.label?-1:1:e.qualifier<t.qualifier?-1:1:e.severity<t.severity})},getReportForItem:function(e){return this._reportItemsMap.hasOwnProperty(String(e.id))||(this._reportItemsMap[String(e.id)]=this._getReportForItem(e)),this._reportItemsMap[String(e.id)]},switchLocale:function(e){this.set("locale",e),this._reportItemsMap={}},_completeLine:function(e,t){var n=Y.clone(this._reportLinesMap[e]);return n.message=se[se[this.locale]&&se[this.locale].hasOwnProperty(e)?this.locale:"root"][e],t&&(n.message=X.substitute(n.message,t)),n.hasOwnProperty("category")||(n.category=q.REPORT_CATEGORY.OTHER),n.hasOwnProperty("modelHealthSummand")||(n.modelHealthSummand=0),n.hasOwnProperty("severity")||(n.severity=0),n},_getBestPracticeLines:function(e){var t=[];e.maximumIfDepth&&e.maximumIfDepth>2&&t.push(this._completeLine("BP0")),e.formula&&e.formula.length>1e3&&t.push(this._completeLine("BP1"));var o=new RegExp(/[\u{1f300}-\u{1f5ff}\u{1f900}-\u{1f9ff}\u{1f600}-\u{1f64f}\u{1f680}-\u{1f6ff}\u{2600}-\u{26ff}\u{2700}-\u{27bf}\u{1f1e6}-\u{1f1ff}\u{1f191}-\u{1f251}\u{1f004}\u{1f0cf}\u{1f170}-\u{1f171}\u{1f17e}-\u{1f17f}\u{1f18e}\u{3030}\u{2b50}\u{2b55}\u{2934}-\u{2935}\u{2b05}-\u{2b07}\u{2b1b}-\u{2b1c}\u{3297}\u{3299}\u{303d}\u{00a9}\u{00ae}\u{2122}\u{23f3}\u{24c2}\u{23e9}-\u{23ef}\u{25b6}\u{23f8}-\u{23fa}]/gu);if(e.label){var r=e.label.match(o);r&&r.length>0&&t.push(this._completeLine("BP2"))}if(e.formula&&e.formula.length>0&&(r=e.formula.match(o))&&r.length>0&&t.push(this._completeLine("BP3")),e.hasOwnProperty("moduleEntityLongId")){this._includeDashboardAnalysis&&!this._publishedModulesMap.hasOwnProperty(String(e.moduleEntityLongId))&&this._top80PercentModuleEntityLongIds.indexOf(e.moduleEntityLongId)>-1&&t.push(this._completeLine("BP4")),e.cellCount>q.LARGE_CELL_COUNT_THRESHOLD&&(t.push(this._completeLine("BP5",e)),e.versions!==q.NOT_APPLICABLE&&t.push(this._completeLine("BP6",e)));var s=this._getHigherReferences(e),l=this._publishedLineItemsMap[String(e.id)]||[];if(!e.summary||"NONE"===e.summary||s.length||l.length||t.push(this._completeLine("BP7",e)),e._appliesTo&&e._appliesTo.length)if(e._appliesTo.some(function(e){this._getSizeForHierarchy(e)}.bind(this)))console.warn("TODO: Unable to process appliesTo order; one or more unexpected dimension(s)",e._appliesTo);else{var d=e._appliesTo.slice();d.sort(function(e,t){return this._getSizeForHierarchy(e)<this._getSizeForHierarchy(t)}.bind(this)),JSON.stringify(e._appliesTo)!==JSON.stringify(d)&&t.push(this._completeLine("BP8",{recommendedAppliesTo:d.map(function(e){return i.getLabelForDimensionIdentifier(n,a.entityLongIdToEntityLongIdIdentifier(e))}).join(", ")}))}}else"TEXT"===e.dataType&&this._hierarchies(String(e.hierarchyEntityLongId)).itemCount>q.LARGE_LIST_THRESHOLD&&t.push(this._completeLine("BP9",this._hierarchies(String(e.hierarchyEntityLongId))));return _e.findSumAndLookup(e.formula)&&t.push(this._completeLine("BP10",e)),t},_getHigherReferences:function(e){var t=(e._fullAppliesTo||[]).reduce(function(e,t){return e=e.concat(this._hierarchies[String(t)]?this._hierarchies[String(t)].parents:[])}.bind(this),[]);return e.referencedBy.filter(function(e){return e.fullAppliesTo.some(function(e){return t.indexOf(e)>-1})})},_getOtherLines:function(e){var t=[];if(e.formulaTokenCounts&&_e.getCumulativeTokenCount(e.formulaTokenCounts,["&","FIND","SUBSTITUTE","LEFT","RIGHT","MID","LEN","LENGTH","TEXTLIST","NAME","CODE"])>0&&t.push(this._completeLine("OT0")),e.formulaTokenCounts&&_e.getCumulativeTokenCount(e.formulaTokenCounts,["LAG","OFFSET"])>0&&t.push(this._completeLine("OT1")),e.hasOwnProperty("moduleEntityLongId")&&(1===e.refersToCount&&e.tokenizedFormula&&1===e.tokenizedFormula.length&&t.push(this._completeLine("OT2")),"Day"===e.timeScale&&t.push(this._completeLine("OT3",e)),"true"===e.useSwitchover&&e.versions!==q.NOT_APPLICABLE&&t.push(this._completeLine("OT4")),e.timeRange&&-1===[q.MODEL_CALENDAR,q.NOT_APPLICABLE].indexOf(e.timeRange)&&t.push(this._completeLine("OT5")),e.blockEstimate&&e.blockEstimate>q.ITEM_BLOCK_ESTIMATE_INFO_THRESHOLD&&t.push(this._completeLine("OT6",e)),e.blockEstimate&&e.blockEstimate>q.ITEM_BLOCK_ESTIMATE_WARN_THRESHOLD&&t.push(this._completeLine("OT7",e)),this._includeDashboardAnalysis)){var n=this._publishedLineItemsMap[String(e.id)]||[];n.length&&t.push(this._completeLine("OT8",{dashboardCount:n.length}))}var i=this._getHigherReferences(e);return i.length&&t.push(this._completeLine("OT9",{higherReferenceCount:i.length})),t},_getPlanualLines:function(e){var t=[],n=new RegExp(/[\u{1f300}-\u{1f5ff}\u{1f900}-\u{1f9ff}\u{1f600}-\u{1f64f}\u{1f680}-\u{1f6ff}\u{2600}-\u{26ff}\u{2700}-\u{27bf}\u{1f1e6}-\u{1f1ff}\u{1f191}-\u{1f251}\u{1f004}\u{1f0cf}\u{1f170}-\u{1f171}\u{1f17e}-\u{1f17f}\u{1f18e}\u{3030}\u{2b50}\u{2b55}\u{2934}-\u{2935}\u{2b05}-\u{2b07}\u{2b1b}-\u{2b1c}\u{3297}\u{3299}\u{303d}\u{00a9}\u{00ae}\u{2122}\u{23f3}\u{24c2}\u{23e9}-\u{23ef}\u{25b6}\u{23f8}-\u{23fa}]/gu);if(e.label){var i=e.label.match(n);i&&i.length>0&&t.push(this._completeLine("Planual-1.08-01"))}return e.formula&&e.formula.length>0&&(i=e.formula.match(n))&&i.length>0&&t.push(this._completeLine("Planual-1.08-01")),e.maximumIfDepth&&e.maximumIfDepth>2&&t.push(this._completeLine("Planual-2.02-01")),t},_getReportForItem:function(e){var t=this._getBestPracticeLines(e).concat(this._getOtherLines(e)).concat(this._getPlanualLines(e)),n=this._mapRefs(e._fullAppliesTo||[],e.referencedBy||[]),i=this._mapRefs(e._fullAppliesTo||[],e.refersTo||[]);return i.filter(function(e){return null!==e}).length&&t.push(this._completeLine("OT10")),t.sort(function(e,t){return e.severity<t.severity}),t.length?{lines:t,referencedBy:n,refersTo:i}:null},_getSizeForHierarchy:function(e){var i=a.getEntityTypeIndex(e)===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX?n.getHierarchyInfoForHierarchySubsetEntityLongId(e).entityLongId:e;return this._hierarchies[String(i)]?this._hierarchies[String(e)].itemCount:-1},_getTop80PercentModuleEntityLongIds:function(e){var t,i=[],o=e.reduce(function(e,n){return n.hasOwnProperty("moduleEntityLongId")&&(t=e[String(n.moduleEntityLongId)]||0,t+=n.cellCount,e[String(n.moduleEntityLongId)]=t),e},{}),r=.8*n.getModelInfo().cellCount,a=0;return Object.keys(o).sort(function(e,t){return o[e]<o[t]}).forEach(function(e){a<r&&i.push(Number(e)),a+=o[e]}),i},_mapRefs:function(e,t){return t.map(function(t){return e&&e.some(function(e){return t.fullAppliesTo&&-1===t.fullAppliesTo.indexOf(e)})||t.fullAppliesTo&&t.fullAppliesTo.some(function(t){return-1===e.indexOf(t)})?this._completeLine("OT11",{dimensionality:t.fullAppliesTo.length?t.fullAppliesTo.map(function(e){return ye.getLabelForDimensionEntityLongId(e)}).join(", "):"0 dimensions"}):null}.bind(this))}}),de=x([A,B],{items:null,pasteSpecial:null,queryTargets:["formulas","dataTypes","hierarchies","hierarchySubsets","properties","modules","lineItems","ids"],COOKIE_VERSION:"1.0.0",DEFAULT_VISIBLE_NON_SYNTHETIC_FIELDS:["format","cellCount"],MODEL_ANALYSIS_COOKIE:"model-analysis",RENDERERS:{cellCount:function(e,t,n,i){n.appendChild(document.createTextNode(s.formatCellCount(t)))},referencedBy:function(e,t,n,i){if(t&&t.length){var o=document.createElement("ul");o.style.listStyle="none",o.style.margin=0,o.style.padding=0,ye.renderListItems(o,t,!0),n.appendChild(o)}}},SORTABLE_NON_SYNTHETIC_FIELDS:["cellCount"],SYNTHETIC_COLUMNS:[{field:"type",hidden:!1,label:"",sortable:!0,width:18},{field:"qualifier",hidden:!1,label:"Module or Hierarchy",sortable:!0,width:120},{field:"label",hidden:!1,label:"Line Item or Property",sortable:!1,width:120},{field:"id",hidden:!0,label:"id",sortable:!0,width:120},{field:"fullAppliesTo",hidden:!1,label:"Full Applies To",renderCell:function(e,t,n,i){if(t&&t.length){var o,r=document.createElement("ul");r.style.listStyle="none",r.style.margin=0,r.style.padding=0,t.forEach(function(e){(o=document.createElement("li")).appendChild(document.createTextNode(e)),r.appendChild(o)}),n.appendChild(r)}},sortable:!1,width:180},{field:"totalTime",hidden:!0,label:"Total Time",renderCell:function(e,t,n,i){-1!==t&&n.appendChild(document.createTextNode(s.formatCellCount(t).replace("cells","ms")))},sortable:!0,width:100},{field:"percentageOfTotalTime",hidden:!0,label:"Percentage of Total Time",renderCell:function(e,t,n,i){-1!==t&&n.appendChild(document.createTextNode(s.formatCellCount(t).replace("cells","%")))},sortable:!0,width:80},{field:"blockEstimate",hidden:!1,label:"Block Est",sortable:!0,width:55},{field:"formulaLength",hidden:!1,label:"Formula Length",sortable:!0,width:55},{field:"formulaComplexity",hidden:!1,label:"Formula Complexity",sortable:!0,width:55},{field:"referencedByCount",hidden:!1,label:"Ref By Count",sortable:!0,width:50},{field:"refersToCount",hidden:!1,label:"Refers To Count",sortable:!0,width:50},{field:"fullAppliesToCount",hidden:!1,label:"Full Applies To Count",sortable:!0,width:50},{field:"tokenizedFormula",label:"Tokenized Formula",hidden:!0,width:120},{field:"formulaTokenCounts",label:"Formula Token Counts",hidden:!0,width:50,renderCell:function(e,t,n,i){t&&n.appendChild(document.createTextNode(JSON.stringify(t)))}},{field:"formulaTokensWithTags",label:"Formula Token with Tags",hidden:!0,width:120},{field:"numberOfIfThenElse",label:"IF / THEN / ELSE Count",sortable:!0,hidden:!1,width:50},{field:"maximumIfDepth",label:"Max IF /THEN /ELSE Depth",sortable:!0,hidden:!1,width:50},{field:"entityHierarchy",hidden:!0,label:"Entity Hierarchy",sortable:!1,width:120},{field:"entityHierarchyItemCount",hidden:!0,label:"Entity Item Count",sortable:!0,width:80},{field:"entitySelectiveAccessApplied",hidden:!0,label:"Entity Sel Acc Applied",sortable:!1,width:50},{field:"entityFormatFilter",hidden:!0,label:"Entity Format Filter",sortable:!1,width:120}],postCreate:function(){this.inherited(arguments);var e=[];if(this.items&&this.items.length){var t=r.loadCookie(this.MODEL_ANALYSIS_COOKIE);t&&t.version===this.COOKIE_VERSION?(console.log("using cookie"),e=this._getColumnsFromCookieUsingItem(t.columns.map(function(e){return{field:e.f,hidden:Boolean(e.h),width:e.w}}),this.items[0])):(console.log("using defaults"),e=this.SYNTHETIC_COLUMNS.concat(this._getNonSyntheticColumnsUsingItem(this.items[0])))}var n=new J({columns:e,selectionMode:"single",store:new j({data:this.items})});this.addChild(n),this.own(n.on("dgrid-select",function(e){this.emit("navigate",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=n},destroy:function(){this.items&&this.items.length&&r.createCookie(this.MODEL_ANALYSIS_COOKIE,{version:this.COOKIE_VERSION,columns:this._customGrid.subRows[0].map(function(e){return{f:e.field,h:Number(e.hidden),w:e.width}})})},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)},_augmentCustomGrid:function(e){if(this._customGrid){Object.keys(e[0]).forEach(function(e){"id"!==e&&this._toggleColumnHiddenState(e,!0)}.bind(this));var t=this._customGrid.store;e.forEach(function(e){var n=t.get(e.id);Object.keys(e).forEach(function(t){"id"!==t&&(n[t]=e[t])}),t.put(n)}),this._customGrid.refresh()}},_getColumnsFromCookieUsingItem:function(e,t){var n=this.SYNTHETIC_COLUMNS.concat(this._getNonSyntheticColumnsUsingItem(t)),i=e.reduce(function(e,t,n){return e[t.field]=t,e},{}),o=e.reduce(function(e,t,n){return e[t.field]=n,e},{}),r=n.reduce(function(e,t,n){return e[t.field]=n,e},{});return n.sort(function(e,t){return(o[e.field]||r[e.field])-(o[t.field]||r[t.field])}).map(function(e){return i.hasOwnProperty(e.field)&&(e.hidden=i[e.field].hidden,e.width=i[e.field].width),e})},_getNonSyntheticColumnsUsingItem:function(e){var n=this.SYNTHETIC_COLUMNS.reduce(function(e,t){return e[t.field]=t,e},{});return Object.keys(e).filter(function(e){return!n.hasOwnProperty(e)}).map(function(e){return{field:e,hidden:-1===this.DEFAULT_VISIBLE_NON_SYNTHETIC_FIELDS.indexOf(e),label:e,renderCell:this.RENDERERS[e]||null,sortable:this.SORTABLE_NON_SYNTHETIC_FIELDS.indexOf(e)>-1,width:t.DEFAULT_COLUMN_WIDTH}}.bind(this))},_setPasteSpecialAttr:function(e){this._set("pasteSpecial",e),e&&e.length&&this._augmentCustomGrid(e)},_toggleColumnHiddenState:function(e,t){var n=this._customGrid.columns;this._customGrid.toggleColumnHiddenState(Object.keys(n).filter(function(t){return n[t].field===e})[0],!1)}}),ue=x([C,B],{items:null,heading:"",renderAsText:!1,constructor:function(){this._handles=[],this._tooltips=[]},destroy:function(){this._handles.forEach(function(e){e.remove()}),this._tooltips.forEach(function(e){e.destroy()})},postCreate:function(){if(this.inherited(arguments),this.heading.length){var e=document.createElement("h3");e.appendChild(document.createTextNode(this.heading)),this.domNode.appendChild(e),this._h3=e}var t=document.createElement("div");t.style.overflow="auto";var n=document.createElement("ul");n.style.listStyle="none",n.style.margin=0,n.style.padding="0px 0px 0px 4px",t.appendChild(n),this.domNode.appendChild(t),this._ul=n,this._wrapperDiv=t},layout:function(){H.setMarginBox(this._wrapperDiv,this._h3?{h:this._contentBox.h-H.getMarginSize(this._h3).h}:this._contentBox)},_setItemsAttr:function(e){this._set("items",e);for(var t=this._ul;t&&t.firstChild;)t.removeChild(t.firstChild);this._handles.forEach(function(e){e.remove()}),this._tooltips.forEach(function(e){e.destroy()}),t&&(ye.renderListItems(t,e,this.renderAsText),this._handles.push(V("a",t).on("click",function(e){var t=e.target;this.emit("navigate",Number(t.getAttribute("data-entitylongid")))}.bind(this))),V(".reportSeverity",t).forEach(function(t){this._tooltips.push(new D({connectId:t,label:e[Number(t.getAttribute("data-index"))].report.message}))}.bind(this)))}}),ce=function(e,t){var i=[];if(t.length){i.push({id:"line items/properties",count:t.length,weighting:1});var o=t.reduce(function(e,t){return t.formula&&t.formula.length?e+t.formulaComplexity:e},0);o&&i.push({id:"formula complexities",count:o,weighting:1})}var r=n.getDashboardsLabelPage().count;r&&i.push({id:"dashboards",count:r,weighting:10});var a=n.getHierarchiesLabelPage().count;if(a){i.push({id:"lists",count:a,weighting:5});var s=Object.keys(e).reduce(function(t,n){return e[n].itemCount>q.LARGE_LIST_THRESHOLD?t+1:t},0);s&&i.push({id:"large lists (>"+q.LARGE_LIST_THRESHOLD+")",count:s,weighting:5})}var l=n.getHierarchySubsetsLabelPage().count;l&&i.push({id:"list subsets",count:l,weighting:10});var d=n.getLineItemSubsetsLabelPage().count;d&&i.push({id:"line item subsets",count:d,weighting:15});var u=n.getActionsLabelPage().count;u&&i.push({id:"actions",count:u,weighting:5});var c=n.getImportsLabelPage().count;return c&&i.push({id:"imports",count:c,weighting:10}),{version:"1.0.1",lines:i,score:i.reduce(function(e,t){return e+t.count*t.weighting},0)}},he=function(e){var t=e.filter(function(e){return e.severity>0}).reduce(function(e,t){return(e[t.reportId]=e[t.reportId]||[]).push(t),e},[]),n=ae.reduce(function(e,t){return e[t.reportId]=t,e},{}),i=Object.keys(t).map(function(e){return{id:e,count:t[e].length,severity:n[e].hasOwnProperty("severity")?n[e].severity:0,weighting:n[e].hasOwnProperty("modelHealthSummand")?n[e].modelHealthSummand:0}});return{version:"1.0.0",lines:i.sort(function(e,t){return e.severity===t.severity?e.count===t.count?e.reportId<t.reportId?-1:1:e.count<t.count:e.severity<t.severity}),score:i.reduce(function(e,t){return e+t.count*t.weighting},0)}},pe=x([y],{blockEstimate:-1,modelComplexityReport:null,modelSummaryReport:null,constructor:function(){this._tooltips=[]},postCreate:function(){this.inherited(arguments);var e=document.createElement("ul");e.style.margin=0,e.style.paddingBottom="10px";var t=this._renderMetric("Model Block Estimate",this.blockEstimate,q.MODEL_DATA_BLOCK_ESTIMATE_WARN_THRESHOLD,"data blocks");e.appendChild(t);var n=this.modelComplexityReport;t=this._renderMetric("Model Complexity",n.score,q.MODEL_COMPLEXITY_WARN_THRESHOLD,"nats"),n.lines.length&&(t.style.cursor="pointer",this._tooltips.push(new D({connectId:t,label:this._reportToLabel(n.lines)}))),e.appendChild(t);var i=this.modelSummaryReport;t=this._renderMetric("Model Health",i.score,q.MODEL_HEALTH_WARN_THRESHOLD);var o=this._renderSmiley(i.score,q.MODEL_HEALTH_WARN_THRESHOLD);t.appendChild(o),e.appendChild(t),i.score<0&&(t.style.cursor="pointer",this._tooltips.push(new D({connectId:t,label:this._reportToLabel(i.lines)}))),this.domNode.appendChild(e)},destroy:function(){this._tooltips.forEach(function(e){e.destroy()})},_renderMetric:function(e,t,n,i){var o,r=document.createElement("li");if(r.style.display="inline-block",n<0?t<n:t>n){var a=q.SEVERITIES[2];(o=document.createElement("span")).className="reportSeverity",o.style=a.style,o.appendChild(document.createTextNode(a.indicator)),r.appendChild(o)}return(o=document.createElement("span")).appendChild(document.createTextNode(e+":")),r.appendChild(o),(o=document.createElement("span")).style.paddingLeft="4px",o.appendChild(document.createTextNode(i?s.formatCellCount(t).replace("cells",i+";"):t)),r.appendChild(o),r},_renderSmiley:function(e,t){var n=document.createElement("div"),i=0===e?":-)":(t<0?e<t:e>t)?":-(":":-|";return n.appendChild(document.createTextNode(i)),n.style.marginLeft="6px",n.style.height="14px",n.style.width="14px",n.style.display="inline-block",n.style.transform=n.style.webkitTransform="rotate(90deg)",n},_reportToLabel:function(e){var t,n=document.createElement("ol");n.style.margin=0,n.style.padding=0,e.forEach(function(e){(t=document.createElement("li")).style.listStyle="none",t.appendChild(document.createTextNode(e.count+" "+e.id+" ( * "+e.weighting+")")),n.appendChild(t)});var i=document.createElement("div");return i.appendChild(n),i.innerHTML}}),me=function(){var e,t,i,o=new F,r=n.getHierarchyInfos(),a=n.getHierarchiesLabelPage();return o.resolve(r.reduce(function(n,o,r){return t=a.entityLongIds[0][r],i=a.labels[0][r],o.propertiesLabelPage.entityLongIds.forEach(function(r,a){e=o.propertiesInfo[a].format,n.push({id:r,label:o.propertiesLabelPage.labels[a],hierarchyEntityLongId:t,qualifier:i,formula:o.propertiesInfo[a].formula||null,format:e.dataType,_format:e})}),n},[])),o.promise},ge=function(e){if(!e.referencedBy||!e.referencedBy.length)return[];var t,i,o,r,a,s,l=e.referencedBy,d=n.getModulesLabelPage(),u=n.getHierarchiesLabelPage();n.getHierarchyInfos();return ye.parseDelim(l,",").map(function(e){return ye.parseDelim(e,".").map(function(e){return"'"===(s=e.split("''").join("'")).charAt(0)?s.slice(1,-1):s})}).map(function(s){return i=null,e.hasOwnProperty("moduleEntityLongId")?null!==(o=n.getModuleInfo(e.moduleEntityLongId))&&(i=o.lineItemsLabelPage):i=n.getHierarchyInfo(e.hierarchyEntityLongId).propertiesLabelPage,1===s.length?e.hasOwnProperty("moduleEntityLongId")?{id:null!==i?i.entityLongIds[0][i.labels[0].indexOf(s[0])]:-1,label:[e.qualifier,s[0]].join("."),moduleEntityLongId:e.moduleEntityLongId}:{id:i.entityLongIds[i.labels.indexOf(s[0])],label:[e.hierarchy,s[0]].join("."),hierarchyEntityLongId:e.hierarchyEntityLongId}:(t=[s[0],s[1]].join("."),u.labels[0].indexOf(s[0])>-1?(r=u.entityLongIds[0][u.labels[0].indexOf(s[0])],{id:(a=n.getHierarchyInfo(r).propertiesLabelPage).entityLongIds[a.labels.indexOf(s[1])],hierarchyEntityLongId:r,label:t}):d.labels[0].indexOf(s[0])>-1?(r=d.entityLongIds[0][d.labels[0].indexOf(s[0])],{id:(a=n.getModuleInfo(r).lineItemsLabelPage).entityLongIds[0][a.labels[0].indexOf(s[1])],moduleEntityLongId:r,label:t}):(console.log("TODO: not Full Access or not a lineitem or list property?",s),{id:-1,label:t}))})},fe=x([C,B],{queryTargets:["severities","hierarchies","hierarchySubsets","properties","modules","lineItems","reportCategories","reportIds","ids"],blockEstimate:-1,reportLines:null,modelComplexityReport:null,modelSummaryReport:null,postCreate:function(){this.inherited(arguments);var e=new pe({blockEstimate:this.blockEstimate,modelComplexityReport:this.modelComplexityReport,modelSummaryReport:this.modelSummaryReport});this.addChild(e),this._modelReport=e;var t=new J({columns:[{field:"severity",label:"",renderCell:function(e,t,n,i){var o=q.SEVERITIES[t],r=document.createElement("span");r.className="reportSeverity",r.style=o.style,r.appendChild(document.createTextNode(o.indicator)),n.appendChild(r)},sortable:!0,width:18},{field:"qualifier",label:"Module or Hierarchy",width:120},{field:"label",label:"Line Item or Property",width:120},{field:"modelHealthSummand",hidden:!0,label:"Model Health Summand",sortable:!0,width:80},{field:"itemId",hidden:!0,label:"ItemId",sortable:!0,width:120},{field:"reportId",hidden:!1,label:"ReportId",sortable:!0,width:80},{field:"category",hidden:!0,label:"Category",sortable:!0,width:120},{field:"message",label:"Message"}],selectionMode:"single",store:new j({data:this.reportLines})});this.addChild(t),this.own(t.on("dgrid-select",function(e){this.emit("navigate",Number(e.rows[0].data.itemId))}.bind(this))),this._customGrid=t},layout:function(){var e=this._contentBox;if(this._modelReport){var t=e.h-H.getMarginSize(this._modelReport.domNode).h;this._customGrid&&this._customGrid.resize({h:t,w:e.w})}},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)},_setReportLinesAttr:function(e){if(this._set("reportLines",e),this._customGrid){var t,n=this._customGrid.store;e.forEach(function(e){(t=n.get(e.id)).message=e.message,n.put(t)}),this._customGrid.refresh()}}}),Ee=x([o,G],{dataTypes:null,formulas:null,hierarchies:null,hierarchySubsets:null,lineItems:null,modules:null,properties:null,severities:null,queryTargets:null,reportCategories:null,_find:function(e){return this.queryTargets.map(function(t){return this._filterList(e,t[0].toUpperCase()+t.substring(1),this[t])}.bind(this)).filter(function(e){return e.results.length})}}),Ie=x([y,I,B],{containerId:null,frameworkServices:null,items:null,modelComplexityReport:null,modelSummaryReport:null,FORMULA_PARSER_VERSION:null,REPORT_GENERATOR_VERSION:"1.0.1",postCreate:function(){this.inherited(arguments);var e,n=new v({containerId:this.containerId});this.addChild(n);var i=this._lineItems,o=this._properties,r=new Ee({dataTypes:q.DATA_TYPES.reduce(function(e,t){return e[t]={id:t,label:t.toUpperCase()},e},{}),formulas:q.FUNCTIONS.sort().reduce(function(e,t){return e[t]={id:t,label:t},e},{}),hierarchies:i.reduce(function(n,i){return i._fullAppliesTo.filter(function(e){return a.getEntityTypeIndex(e)!==t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX}).forEach(function(t){e=ye.getLabelForDimensionEntityLongId(t),n[e]={id:String(t),label:e}}),n},{}),hierarchySubsets:i.reduce(function(n,i){return i._fullAppliesTo.filter(function(e){return a.getEntityTypeIndex(e)===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX}).forEach(function(t){e=ye.getLabelForDimensionEntityLongId(t),n[e]={id:String(t),label:e}}),n},{}),lineItems:i.reduce(function(t,n){return t[e=[n.qualifier,n.label].join(".")]={id:String(n.id),label:e},t},{}),modules:i.reduce(function(e,t){return e[t.qualifier]={id:String(t.moduleEntityLongId),label:t.qualifier},e},{}),properties:o.reduce(function(t,n){return e=[n.qualifier,n.label].join("."),t[n.label]={id:String(n.id),label:e},t},{}),severities:Object.keys(q.SEVERITIES).reduce(function(e,t){return e[q.SEVERITIES[t].label]={id:t,label:q.SEVERITIES[t].label},e},{}),reportCategories:Object.keys(q.REPORT_CATEGORY).reduce(function(e,t){return e[t]={id:t,label:t},e},{}),reportIds:ae.reduce(function(e,t){return e[t.reportId]={id:t.reportId,label:t.reportId},e},{}),ids:i.reduce(function(e,t){return e[String(t.id)]={id:String(t.id),label:String(t.id)},e},o.reduce(function(e,t){return e[String(t.id)]={id:String(t.id),label:String(t.id)},e},{})),queryTargets:["severities","hierarchies","hierarchySubsets","properties","modules","lineItems","reportCategories","reportIds","ids"]}),s=this.frameworkServices,l=function(e){return e.map(function(e){return e.join("\t")}).join("\n")},u=function(e){var n=w.byId(this.containerId).selectedChildWidget.getCustomGrid(),i=n.store.query(n.get("query"),{sort:n.get("sort")}),o=n.subRows[0].filter(function(e){return!e.hidden}),r=[];r.push.apply(r,e),r.push.apply(r,[o.map(function(e){return e.label&&e.label.length?e.label:e.field})]),r.push.apply(r,i.map(function(e){return o.map(function(t){return e[t.field]})})),s.doCopy(l(r)).then(function(){W.publish("anaplan/systemmessage",r.length+" lines copied",null,-1,t.SYSTEM_MESSAGE_INFO)})}.bind(this),c=[["Model",window.modelName],["Date/Time",(new Date).toISOString()]],h=new _({label:"Copy",style:"display:none;padding-left:8px;"});this.own(h.on("click",function(){u(c.concat([["Formula Parser Version",this.FORMULA_PARSER_VERSION]]))}.bind(this))),this.addChild(h),this._copyItemsButton=h;var p,m=function(e){return e.map(function(e){return[e.id,e.count,e.weighting]})},g=new O({}),f=this.modelSummaryReport;g.addChild(new P({label:"Copy Summary",onClick:function(){(p=c.concat([["Model Summary Report Generator",f.version],["ReportId","Count","Weighting"]])).push.apply(p,m(f.lines)),s.doCopy(l(p))}}));var E=this.modelComplexityReport;g.addChild(new P({label:"Copy Complexity",onClick:function(){(p=c.concat([["Model Complexity Report Generator",E.version],["Model Complexity Score",E.score],["Structure","Count","Weighting"]])).push.apply(p,m(E.lines)),s.doCopy(l(p))}})),g.addChild(new P({label:"Copy Health",onClick:function(){(p=c.concat([["Model Health Report Generator",f.version],["Model Health Score",f.score],["ReportId","Count","Weighting"]])).push.apply(p,m(f.lines.filter(function(e){return e.weighting<0}))),s.doCopy(l(p))}}));var I=new b({style:"padding-left:8px;",label:"Copy",dropDown:g});this.own(I.on("click",function(){u(c.concat([["Report Generator Version",this.REPORT_GENERATOR_VERSION]]))}.bind(this))),this.addChild(I),this._copyReportLinesButton=I;var y=new Q({columns:[{field:"id",label:"Id",sortable:!0,width:25},{field:"severity",label:"Severity",sortable:!0,width:15},{field:"count",label:"Count",sortable:!0,width:15},{field:"weighting",label:"Weighting",sortable:!0,width:15}],region:"leading",selectionMode:"single",splitter:!0,store:new j({data:f.lines})}),T=new M({style:"width:300px;"});T.addChild(y);var C=new S({label:"Summary",dropDown:T});this.addChild(C),this._summaryGridButton=C;var N=new _({style:"display:none;",label:"Paste Special"});this.addChild(N),this._pasteSpecialButton=N,this.own(N.on("click",function(){this.frameworkServices.doPaste("Paste Special").then(function(e){var n,i,o=this.lineItems,r=o.reduce(function(e,t,n){return(e[t.label]=e[t.label]||[]).push(n),e},{}),a=[],s={hits:0,misses:0,fails:0};e.split("\n").forEach(function(e,t){try{i=e.split("\t"),r.hasOwnProperty(i[1])?1===(n=r[i[1]].map(function(e){return o[e]}).filter(function(e){return e.qualifier===i[0]})).length?(a.push({id:n[0].id,totalTime:Number(i[2]),percentageOfTotalTime:Number(i[3])}),s.hits++):(console.warn("failed to find",i[0]),s.misses++):(console.warn("failed to find",i[1]),s.misses++)}catch(t){console.warn("fail",e),s.fails++}}),W.publish("anaplan/systemmessage",JSON.stringify(s,null,2),null,-1,s.fails?t.SYSTEM_MESSAGE_WARN:s.misses?t.SYSTEM_MESSAGE_WARN:t.SYSTEM_MESSAGE_INFO),this.emit("pasteSpecial",a)}.bind(this))}.bind(this)));var A=new _({disabled:!1,iconClass:"bookmarklet",label:"Bookmark",showLabel:!1,style:"padding-left:8px;"});this.addChild(A);var R=Object.keys(se),D=R.map(function(e){return{label:e,value:e}});console.log("locale",k.locale),D[Math.max(R.indexOf(k.locale),0)].selected=!0;var x=new L({name:"localeSelector",options:D,style:"height:24px;margin-left:8px;"});this.addChild(x),this.own(x.on("change",function(e){this.emit("locale",e)}.bind(this))),this._localeSelector=x,this.own(A.on("click",function(){var e,t,n,i,o=w.byId(this.containerId).selectedChildWidget.getCustomGrid(),r=o.store.query(o.get("query"),{sort:o.get("sort")}).reduce(function(e,t){return(e[t.reportId]=e[t.reportId]||[]).push({entityLongId:t.itemId,label:[t.qualifier,t.label].join(".")}),e},{}),a=ae.reduce(function(e,t){return e[t.reportId]=t,e},{});W.publish("anaplan/bookmark",Object.keys(r).reduce(function(o,s){return n=q.SEVERITIES[a[s].severity||0],t=document.createElement("span"),(e=document.createElement("span")).className="reportSeverity",e.style=n.style,e.appendChild(document.createTextNode(n.indicator)),t.appendChild(e),(i=document.createElement("span")).appendChild(document.createTextNode(s+" "+a[s].message)),t.appendChild(i),o.push(t.innerHTML),o.push.apply(o,r[s]),o}.bind(this),[]))}.bind(this))),this._bookmarklet=A;var Y=new d({store:r,style:"float:right;"});this.addChild(Y),this.own(Y.on("selection",function(e){if(e.hasOwnProperty("selection")){var t=e.selection;Y.searchBar.textBox.value=t.label,this.emit("query",t)}}.bind(this))),this.own(Y.on("cancel",function(){this.emit("cancel")}.bind(this))),this.own(y.on("dgrid-select",function(e){var t=e.rows[0].data.id;this.emit("query",{id:t,label:t})}.bind(this))),this.own(y.on("dgrid-deselect",function(e){this.emit("cancel")}.bind(this))),this.own(W.subscribe(this.containerId+"-selectChild",function(e){r.set("queryTargets",e.queryTargets),this._bookmarklet.domNode.style.display=e instanceof fe?"":"none",this._localeSelector.domNode.style.display=e instanceof fe?"":"none",this._copyReportLinesButton.domNode.style.display=e instanceof fe?"":"none",this._summaryGridButton.domNode.style.display=e instanceof fe?"":"none",this._copyItemsButton.domNode.style.display=e instanceof fe?"none":"",this._pasteSpecialButton.domNode.style.display=e instanceof fe?"none":""}.bind(this)))},_setItemsAttr:function(e){this._set("items",e);var t=[],n=[];null!==e&&e.forEach(function(e){(e.hasOwnProperty("moduleEntityLongId")?t:n).push(e)}),this._lineItems=t,this._properties=n}}),ye={getBlockEstimateFactorForTime:function(e,i){var o=0;try{e.timeRange&&e.timeRange!==q.MODEL_CALENDAR&&console.warn("getBlockEstimateFactorForTime TODO: support for timeRange"+[e.qualifier,e.label].join("."),e.timeRange);var r=n.getTimescaleInfo(),s=-1;r.allowedTimeEntityPeriodTypes.forEach(function(t,n){t.entityLabel===e.timeScale&&(s=n)}),-1===s&&("Day"===e.timeScale?Number(i.calendarType)===a.getEntityLongId(t.CALENDAR_TYPE_ENTITY_TYPE_INDEX,t.CALENDAR_TYPE_WEEKS_GENERAL_ENTITY_INDEX)?o=7*Number(i.weekCount):(console.info("getBlockEstimateFactorForTime calendartype not weekly assuming 365 days"+[e.qualifier,e.label].join("."),e.timeScale,i),o=365*(1+Number(i.pastPeriodCount)+Number(i.futurePeriodCount))):(console.warn("getBlockEstimateFactorForTime TODO: unexpected timeScale?"+[e.qualifier,e.label].join("."),e.timeScale,i),o=0),s=0);for(var l=s;l<r.allowedTimeEntityPeriodTypeLabelPages.length;l++)o+=r.allowedTimeEntityPeriodTypeLabelPages[l].count}catch(t){console.error("getBlockEstimateFactorForTime",e,t)}return o},getBlockEstimateFactorForVersions:function(e,t){var n=t.filter(function(e){return e.useSwitchover}).map(function(e){return[e.version,e.useSwitchover].join(":")});return"true"===e.useSwitchover&&n.length&&console.warn("getBlockEstimateFactorForVersions TODO: "+[e.qualifier,e.label].join(".")+" may be unreliable includes versions with switchovers",n.join(", ")),t.length},getBlockEstimateFactorForHierarchy:function(e,i){for(var o=1;e.parentHierarchyEntityLongId>-1;)e=a.getEntityTypeIndex(e.parentHierarchyEntityLongId)===t.HIERARCHY_ENTITY_TYPE_INDEX?n.getHierarchyInfo(e.parentHierarchyEntityLongId):n.getHierarchySubsetInfo(e.parentHierarchyEntityLongId),o++;a.getEntityTypeIndex(e.entityLongId)===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX&&(console.info("getBlockEstimateFactorForHierarchy TODO: basing item count on main hierarchy for top level",ye.getLabelForDimensionEntityLongId(e.entityLongId)),e=n.getHierarchyInfoForHierarchySubsetEntityLongId(e.entityLongId));var r=i.hasOwnProperty(String(e.entityLongId))?i[String(e.entityLongId)].itemCount:e.itemCount,s=i[String(e.entityLongId)]&&i[String(e.entityLongId)].topLevel&&i[String(e.entityLongId)].topLevel.length;return s&&o++,r>(s?2:1)&&(console.warn("getBlockEstimateFactorForHierarchy TODO: incrementing based on item count (not reliable)",ye.getLabelForDimensionEntityLongId(e.entityLongId),r),o++),o},getLabelForDimensionEntityLongId:function(e){var o=a.entityLongIdToEntityLongIdIdentifier(e),r=i.getLabelForDimensionIdentifier(n,o);if(a.getEntityTypeIndex(e)===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX){var s=n.getHierarchyInfoForHierarchySubsetEntityLongId(e);return r+" ("+i.getLabelForDimensionIdentifier(n,a.entityLongIdToEntityLongIdIdentifier(s.entityLongId))+")"}return r},parseDelim:function(e,t){var n=[];if(e&&e.length){for(var i=!1,o=0,r=0;o<e.length;)"'"===e.charAt(o)?"'"===e.charAt(o+1)?o+=2:(i=!i,o+=1):(i||e.charAt(o)!==t||(n.push(e.substring(r,o).trim()),r=o+1),o+=1);n.push(e.substring(r).trim())}return n},renderListItems:function(e,t,n){var i,o,r,a;t.forEach(function(t,s){o=document.createElement("li"),n?o.appendChild(document.createTextNode(t.label)):((i=document.createElement("a")).style.cursor="pointer",i.setAttribute("data-entitylongid",t.id),i.appendChild(document.createTextNode(t.label)),o.appendChild(i)),t.decoration&&t.decoration.length&&((a=document.createElement("span")).appendChild(document.createTextNode(t.decoration.map(function(e){return"("+e+")"}).join(""))),o.appendChild(a)),t.report&&(r=q.SEVERITIES[t.report.severity],(a=document.createElement("span")).className="reportSeverity",a.style=r.style,a.appendChild(document.createTextNode(r.indicator)),a.setAttribute("data-index",s),a.style.cursor="pointer",o.appendChild(a)),e.appendChild(o)})}},Te=x([N,B],{baseClass:"extension modelanalysis",frameworkServices:null,gutters:!0,pasteSpecial:null,postCreate:function(){this.inherited(arguments),this.addChild(new A({region:"center",content:'<div class="circles-loader__container"><div class="circles-loader"><div class="circles-loader__discs"><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,64 C49.673112,64 64,49.673112 64,32 C64,14.326888 49.673112,0 32,0 C14.326888,0 0,14.326888 0,32 C0,49.673112 14.326888,64 32,64 Z M32,60 C47.463973,60 60,47.463973 60,32 C60,16.536027 47.463973,4 32,4 C16.536027,4 4,16.536027 4,32 C4,47.463973 16.536027,60 32,60 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg></div></div>'}))},startup:function(){this.inherited(arguments),me().then(function(e){var o,r=e.reduce(function(e,t){return t.formula&&!e.hasOwnProperty(String(t.hierarchyEntityLongId))&&((o=(new $).buildViewRequest()).viewDefinition.staticContextIdentifiers=[a.entityLongIdToEntityLongIdIdentifier(t.hierarchyEntityLongId)],e[String(t.hierarchyEntityLongId)]=o),e},{}),s=(new Date).getTime();new l({showPleaseWait:!1}).post([],[(new te).buildViewRequest(),(new Z).buildViewRequest(),(new ne).buildViewRequest(),(new ee).buildViewRequest()].concat(Object.keys(r).map(function(e){return r[e]})),[]).then(function(o){var r=o.result.viewRequestResults;console.log("loaded",(new Date).getTime()-s+"ms",r.length,"view request results");try{s=(new Date).getTime();var l,d=this._extractTime(r.shift()),u=this._extractHierarchies(r.shift()),c=this._extractVersions(r.shift()),h=this._extractLineItems(r.shift(),u,c,d),p=this._extractProperties(e,r,u);console.log("extracted",(new Date).getTime()-s+"ms");var m={};s=(new Date).getTime();var g=h.concat(p);g.forEach(function(e){return"ENTITY"===e._format.dataType?(e.entityFormatFilter=e._format.entityFormatFilter?JSON.stringify(e._format.entityFormatFilter):"",e.entitySelectiveAccessApplied=e._format.selectiveAccessApplied,(l=u[String(e._format.hierarchyEntityLongId)])?(e.entityHierarchy=l.label+(l.decoration||[]).map(function(e){return"("+e+")"}).join(""),e.entityHierarchyItemCount=l.itemCount):(e.entityHierarchy=i.getLabelForDimensionIdentifier(n,a.entityLongIdToEntityLongIdIdentifier(e._format.hierarchyEntityLongId)),e.entityHierarchyItemCount=-1)):(e.entityFormatFilter="n/a",e.entityHierarchy="n/a",e.entityHierarchyItemCount=-1,e.entitySelectiveAccessApplied="n/a"),e.decoration=(e.format===t.dataTypes.NONE?[]:[e.format.split("_").reduce(function(e,t){return e=e.concat(t[0].toLowerCase())},[]).join("")]).concat(e.formula?["fx"]:[]),e.formulaLength=e.formula?e.formula.length:0,e.tokenizedFormula=_e.tokenizeFormula(e.formula),e.formulaTokensWithTags=_e.tagTokensInFormula(e.tokenizedFormula,u),e.formulaTokenCounts=e.tokenizedFormula.reduce(function(e,t){return e[t]=(e[t]?e[t]:0)+1,e},{}),e.numberOfIfThenElse=e.formulaTokenCounts.IF||0,e.maximumIfDepth=_e.getIfMaxDepth(e.tokenizedFormula),e.formulaComplexity=_e.calculateComplexityScore(e.formula,e.tokenizedFormula,e.formulaTokenCounts,e.numberOfIfThenElse,e.maximumIfDepth),e.referencedBy=ge(e),e.referencedBy.forEach(function(t){(m[t.id]=m[t.id]||[]).push({id:e.id,label:[e.qualifier,e.label].join("."),fullAppliesTo:e.hasOwnProperty("_fullAppliesTo")?e._fullAppliesTo:null,decoration:e.decoration})}),e.referencedByCount=e.referencedBy.length,e.totalTime=e.percentageOfTotalTime=-1,e});var f=g.reduce(function(e,t){return e[String(t.id)]={fullAppliesTo:t._fullAppliesTo||null,decoration:t.decoration||[]},e},{});g.forEach(function(e){e.referencedBy&&e.referencedBy.forEach(function(e){e.decoration=f[String(e.id)]?f[String(e.id)].decoration:[],e.fullAppliesTo=f[String(e.id)]?f[String(e.id)].fullAppliesTo:null}),e.refersTo=m[e.id]||[],e.refersToCount=e.refersTo.length}),console.log("processed",(new Date).getTime()-s+"ms",g.length,"items"),this._renderUI(g,u)}catch(e){console.error(e)}}.bind(this))}.bind(this))},_extractHierarchies:function(e){var o,r,l=e.columnLabelPages[0].entityLongIds[0].indexOf(t.SYSTEM_PROPERTY_HIERARCHY_TOP_LEVEL),d=e.columnLabelPages[0].entityLongIds[0].indexOf(t.SYSTEM_PROPERTY_HIERARCHY_ITEM_COUNT),u=e.dataPages[0].cellValues,c=e.rowLabelPages[0].entityLongIds[0].reduce(function(t,n,i){return t[String(n)]={topLevel:u[i*e.columnCount+l],itemCount:u[i*e.columnCount+d]},t},{}),h=n.getHierarchiesLabelPage(),p=n.getHierarchySubsetsLabelPage(),m=n.getHierarchyInfos(),g=n.getHierarchySubsetInfos();return h.entityLongIds[0].reduce(function(e,t,n){return o=m[n],r=c.hasOwnProperty(String(t))?c[String(t)].itemCount:o.itemCount,e[String(t)]={label:label=h.labels[0][n],decoration:[s.formatCellCount(r).replace("cells","items")],itemCount:r,blockEstimateFactor:ye.getBlockEstimateFactorForHierarchy(o,c),parents:this._getParents(o)},e}.bind(this),p.entityLongIds[0].reduce(function(e,t,r){return o=n.getHierarchyInfoForHierarchySubsetEntityLongId(t),e[String(t)]={label:p.labels[0][r],decoration:[i.getLabelForDimensionIdentifier(n,a.entityLongIdToEntityLongIdIdentifier(o.entityLongId))],itemCount:-1,blockEstimateFactor:ye.getBlockEstimateFactorForHierarchy(g[r],c),parents:this._getParents(g[r])},e}.bind(this),{}))},_extractLineItems:function(e,o,r,s){var l,d,u,c,h,p,m,g,f,E,I,y,T,_,b,S,L=e.dataPages[0].cellText,C=e.dataPages[0].cellValues,N=e.columnLabelPages[0].entityLongIds[0],A=N.indexOf(4000000212),R=[],v=(n.getTimescaleInfo(),{4000000203:function(e,t){return JSON.parse(t).summaryMethod},4000000212:function(e,t){return JSON.parse(t).dataType},4000000356:function(e,t){return Number(t)}}),O=e.columnLabelPages[0].labels[0].map(function(e){return e[0].toLowerCase()+e.split(" ").join("").split("-").join("").substring(1)});return e.rowLabelPages[0].entityLongIds[0].forEach(function(P,w){a.getEntityTypeIndex(P)===t.MODULE_ENTITY_TYPE_INDEX?(b=e.rowLabelPages[0].labels[0][w],T=P,_=n.getModuleInfo(P)):(y=e.rowLabelPages[0].labels[0][w],S=w*e.columnCount,E=N.reduce(function(e,t,n){return h=O[n],c=C[S+n],u=L[S+n],e[h]=v[String(t)]?v[String(t)].call(this,u,c):u||c,e},{id:P,qualifier:b,moduleEntityLongId:T,label:y,type:""}),p=JSON.parse(C[S+A]),E._format=p,null===(I=i.getLineItemInfoFromModuleInfo(_,P))?(console.warn("failed to find lineItemInfo for "+y+" full access?"),l=null,E._fullAppliesTo=E.fullAppliesTo=[],E._appliesTo=null):(l=1,E._appliesTo="-"===E.appliesTo?_.appliesTo:I.appliesTo,E._fullAppliesTo=I.fullAppliesTo||[],E.fullAppliesTo=E._fullAppliesTo.map(function(e){return o.hasOwnProperty(String(e))?(m=o[String(e)],f=m.label,g=m.decoration,d=m.blockEstimateFactor):(f=i.getLabelForDimensionIdentifier(n,a.entityLongIdToEntityLongIdIdentifier(e)),g=[],d=1,[t.SYSTEM_AXIS_IDENTIFIER_TIME_ENTITY_LONG_ID,t.SYSTEM_AXIS_IDENTIFIER_TIME_WITH_BROUGHT_FORWARD_PERIOD_ENTITY_LONG_ID].indexOf(e)>-1?(["timeScale","timeRange"].forEach(function(e){E.hasOwnProperty(e)&&g.push(E[e])}),d=ye.getBlockEstimateFactorForTime(E,s)):e===t.SYSTEM_AXIS_IDENTIFIER_VERSION_ENTITY_LONG_ID?d=ye.getBlockEstimateFactorForVersions(E,r):console.warn("LineItemExtractor using default blockEstimateFactor 1 for hierarchy",f)),l*=d,f+g.concat([d]).map(function(e){return"("+e+")"}).join("")})),E.fullAppliesToCount=E.fullAppliesTo.length,E.blockEstimate=l,R.push(E))}.bind(this)),R},_extractProperties:function(e,n,i){var o,r=e.reduce(function(e,t){return t.type="P",t._appliesTo=t.appliesTo=null,t._fullAppliesTo=[t.hierarchyEntityLongId],o=i[String(t.hierarchyEntityLongId)],t.fullAppliesTo=[o.label+o.decoration.concat([o.blockEstimateFactor]).map(function(e){return"("+e+")"}).join("")],t.fullAppliesToCount=t.fullAppliesTo.length,t.cellCount=o.itemCount,t.blockEstimate=o.blockEstimateFactor,t.referencedBy=[],t.summary=null,e[String(t.id)]=t,e},{});return n.forEach(function(e,n){columnIndex=e.columnLabelPages[0].entityLongIds[0].indexOf(t.SYSTEM_PROPERTY_REFERENCED_BY),e.rowLabelPages[0].entityLongIds[0].forEach(function(t,n){r[String(t)].referencedBy=e.dataPages[0].cellValues[n*e.columnCount+columnIndex]})}),Object.keys(r).map(function(e){return r[e]})},_extractTime:function(e){var n=e.rowLabelPages[0].entityLongIds[0],i=e.dataPages[0].cellValues;return{calendarType:i[n.indexOf(t.SYSTEM_PROPERTY_TIME_CALENDAR_TYPE)],pastPeriodCount:i[n.indexOf(t.SYSTEM_PROPERTY_TIME_PAST_PERIOD_COUNT)],futurePeriodCount:i[n.indexOf(t.SYSTEM_PROPERTY_TIME_FUTURE_PERIOD_COUNT)],weekCount:i[n.indexOf(t.SYSTEM_PROPERTY_TIME_WEEK_COUNT)]}},_extractVersions:function(e){var n=e.columnLabelPages[0].entityLongIds[0].indexOf(t.SYSTEM_PROPERTY_VERSION_SWITCHOVER);return e.rowLabelPages[0].entityLongIds[0].map(function(t,i){return{id:String(t),version:e.rowLabelPages[0].labels[0][i],useSwitchover:e.dataPages[0].cellText[i*e.columnCount+n]}})},_getParents:function(e){for(var i=[],o=e.parentHierarchyEntityLongId;o>-1;)i.push(o),o=(a.getEntityTypeIndex(o)===t.HIERARCHY_ENTITY_TYPE_INDEX?n.getHierarchyInfo(o):n.getHierarchySubsetInfo(o)).parentHierarchyEntityLongId;return i},_getPublishedLineItemsMap:function(){var e,t,i=n.getDashboardsLabelPage();return i.entityLongIds[0].reduce(function(o,r,s){try{e=i.labels[0][s],JSON.parse(n.getDashboardInfo(r).dashboardDefinitionJsonString).dashboardElements.filter(function(e){return"CELL"===e.dashboardElementType}).forEach(function(n){t=a.entityLongIdIdentifierToEntityLongId(n.viewDefinition.rowAxisSpecification.axisDefinition.selectionDefinition.selectionRules[0].elementAxis.itemIdentifiers[0][0]),(o[String(t)]=o[String(t)]||[]).push(e)})}catch(t){console.log("_getPublishedLineItemsMap empty dashboard?",e)}return o},{})},_getPublishedModulesMap:function(){var e,t,o=n.getDashboardsLabelPage();return o.entityLongIds[0].reduce(function(r,a,s){try{e=o.labels[0][s],JSON.parse(n.getDashboardInfo(a).dashboardDefinitionJsonString).dashboardElements.filter(function(e){return e.viewDefinition&&null!==i.getModuleEntityLongIdForViewDefinitionOrReference(n,e.viewDefinition)}).forEach(function(o){t=i.getModuleEntityLongIdForViewDefinitionOrReference(n,o.viewDefinition),(r[String(t)]=r[String(t)]||[]).push(e)})}catch(t){console.log("_getPublishedModulesMap empty dashboard?",e)}return r},{})},_renderUI:function(e,n){this.removeChild(this.getChildren()[0]);var i=new R({region:"top",style:"height:45%",splitter:!0}),o=new le({hierarchies:n,items:e,locale:se.hasOwnProperty(k.locale)?k.locale:"root",publishedLineItemsMap:this._getPublishedLineItemsMap(),publishedModulesMap:this._getPublishedModulesMap()}),r=o.getReportLines(e),s=ce(n,e),l=he(r),d=e.reduce(function(e,t){return t.hasOwnProperty("moduleEntityLongId")&&t.blockEstimate?e+t.blockEstimate:e},0),u=new Ie({containerId:i.id,frameworkServices:this.frameworkServices,items:e,modelComplexityReport:s,modelSummaryReport:l,region:"top",style:"height:26px;",FORMULA_PARSER_VERSION:_e.FORMULA_PARSER_VERSION,REPORT_GENERATOR_VERSION:o.REPORT_GENERATOR_VERSION});this.addChild(u),this.own(u.on("pasteSpecial",function(e){this._itemsPane.set("pasteSpecial",e),this.emit("pasteSpecial",e)}.bind(this)));var c=new fe({blockEstimate:d,reportLines:r,modelComplexityReport:s,modelSummaryReport:l,title:"Report"});i.addChild(c);var h=new de({items:e,title:"Items"});i.addChild(h),this.addChild(i),h.set("pasteSpecial",this.pasteSpecial);var p=new z({items:e,region:"center",itemReportGenerator:o});this.addChild(p),this.own(p.on("navigate",function(e){this.emit("navigate",e)}.bind(this))),[h,c].forEach(function(e){this.own(e.on("navigate",function(e){p.set("history",[]),p.set("entityLongId",e)}))}.bind(this));i.selectedChildWidget;this.own(u.on("query",function(e){var n,o=e.id;if(q.FUNCTIONS.indexOf(o)>-1)n=function(e){return e.formula&&e.formula.indexOf(o)>-1};else if(q.SEVERITIES[Number(o)])n={severity:Number(o)};else if(q.REPORT_CATEGORY[o])n={category:o};else if(q.DATA_TYPES.indexOf(e.id)>-1)n={format:e.label};else if(ae.map(function(e){return e.reportId}).indexOf(e.id)>-1)n={reportId:e.id};else{var r=Number(o),s=e.label;switch(a.getEntityTypeIndex(r)){case t.MODULE_ENTITY_TYPE_INDEX:n=function(e){return e.qualifier&&e.qualifier===s||e.moduleEntityLongId&&e.moduleEntityLongId===r};break;case t.HIERARCHY_ENTITY_TYPE_INDEX:case t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX:n=function(e){return e.qualifier&&e.qualifier===s||e.hierarchyEntityLongId&&e.hierarchyEntityLongId===r||e._fullAppliesTo&&e._fullAppliesTo.indexOf(r)>-1};break;default:n=function(e){return e.id===r||e.itemId===r||e.referencedBy&&e.referencedBy.map(function(e){return e?e.id:-1}).indexOf(r)>-1||e.refersTo&&e.refersTo.map(function(e){return e?e.id:-1}).indexOf(r)>-1}}}i.selectedChildWidget.setQuery(n)})),this.own(u.on("cancel",function(){i.selectedChildWidget.setQuery(null)})),this.own(u.on("locale",function(t){o.switchLocale(t),c.set("reportLines",o.getReportLines(e)),p.set("entityLongId",p.get("entityLongId"))}.bind(this))),this._itemsPane=h}}),_e={FORMULA_PARSER_VERSION:"1.0.0",findSumAndLookup:function(e){var t=!1;if(""==e||null==e)return t;var n=e.split("[");for(let e=1;e<n.length;e++)if(section=n[e],closeBracket=section.search("]"),closeBracket>-1&&(section=section.substring(0,closeBracket-1),section.search("LOOKUP:")>-1&&section.search("SUM:")>-1)){t=!0;break}return t},calculateComplexityScore:function(e,t,n,i,o){if(!e)return 0;var r=0,a={CURRENTPERIODSTART:2,ISFIRSTOCCURRENCE:4,CURRENTPERIODEND:2,ISCURRENTVERSION:2,ISACTUALVERSION:2,PREVIOUSVERSION:2,CURRENTVERSION:2,HALFYEARTODATE:3,FIRSTNONBLANK:4,HALFYEARVALUE:2,QUARTERTODATE:2,FIRSTNONZERO:2,LASTNONBLANK:2,QUARTERVALUE:2,RANKCUMULATE:8,ARRIVALRATE:5,AVGDURATION:5,DAYSINMONTH:2,MONTHTODATE:2,NEXTVERSION:2,ANSWERTIME:5,DAYSINYEAR:2,DECUMULATE:6,ISANCESTOR:2,ISNOTBLANK:2,MONTHVALUE:2,SUBSTITUTE:4,WEEKTODATE:3,YEARTODATE:3,ADDMONTHS:2,MOVINGSUM:5,WEEKVALUE:2,YEARVALUE:2,ADDYEARS:2,CUMPRINC:5,CUMULATE:6,"ERLANG-B":5,"ERLANG-C":5,FINDITEM:4,INPERIOD:2,MAKELINK:2,PREVIOUS:2,TEXTLIST:6,AGENTSB:5,AVGWAIT:5,COLLECT:4,COMPARE:3,CUMIPMT:5,ISBLANK:2,PROFILE:6,TIMESUM:6,WEEKDAY:2,AGENTS:5,DIVIDE:2,LENGTH:2,LOOKUP:5,MAILTO:2,MROUND:3,OFFSET:4,PARENT:2,PERIOD:3,SELECT:4,SPREAD:6,BLANK:1,LOWER:2,MONTH:2,POWER:2,RIGHT:2,ROUND:3,START:2,UPPER:2,VALUE:2,CODE:2,DATE:2,DAYS:2,FIND:3,IPMT:5,ITEM:2,LEAD:4,LEFT:2,NAME:2,NEXT:2,NPER:5,POST:4,PPMT:5,RANK:5,RATE:5,SIGN:4,SQRT:2,TEXT:2,TRIM:3,YEAR:1,ABS:2,AND:3,DAY:2,END:2,EXP:2,IRR:4,LAG:5,LEN:2,LOG:3,MAX:3,MID:3,MIN:3,MOD:3,NOT:3,NPV:5,PMT:5,SLA:5,SUM:5,FV:3,LN:4,OR:3,PV:3,"+":2,"-":2,"/":2,"*":2,"<=":2,">=":2,"<>":2,">":2,"<":2,"=":2},s={CURRENTPERIODSTART:1,ISFIRSTOCCURRENCE:1,CURRENTPERIODEND:1,ISCURRENTVERSION:1,ISACTUALVERSION:1,PREVIOUSVERSION:1,CURRENTVERSION:1,HALFYEARTODATE:1,FIRSTNONBLANK:1,HALFYEARVALUE:1,QUARTERTODATE:1,FIRSTNONZERO:1,LASTNONBLANK:1,QUARTERVALUE:1,RANKCUMULATE:1,ARRIVALRATE:1,AVGDURATION:1,DAYSINMONTH:1,MONTHTODATE:1,NEXTVERSION:1,ANSWERTIME:1,DAYSINYEAR:1,DECUMULATE:1,ISANCESTOR:1,ISNOTBLANK:1,MONTHVALUE:1,SUBSTITUTE:1,WEEKTODATE:1,YEARTODATE:1,ADDMONTHS:1,MOVINGSUM:1,WEEKVALUE:1,YEARVALUE:1,ADDYEARS:1,CUMPRINC:1,CUMULATE:1,"ERLANG-B":1,"ERLANG-C":1,FINDITEM:1,INPERIOD:1,MAKELINK:1,PREVIOUS:1,TEXTLIST:3,AGENTSB:1,AVGWAIT:1,COLLECT:1,COMPARE:1,CUMIPMT:1,ISBLANK:1,PROFILE:1,TIMESUM:1,WEEKDAY:1,AGENTS:1,DIVIDE:1,LENGTH:1,LOOKUP:1,MAILTO:1,MROUND:1,OFFSET:1,PARENT:1,PERIOD:1,SELECT:2,SPREAD:1,BLANK:0,LOWER:1,MONTH:1,POWER:1,RIGHT:1,ROUND:1,START:1,UPPER:1,VALUE:1,CODE:1,DATE:1,DAYS:1,FIND:1,IPMT:1,ITEM:1,LEAD:1,LEFT:1,NAME:1,NEXT:1,NPER:1,POST:1,PPMT:1,RANK:1,RATE:1,SIGN:1,SQRT:1,TEXT:1,TRIM:1,YEAR:1,ABS:1,AND:2,DAY:1,END:1,EXP:1,IRR:1,LAG:1,LEN:1,LOG:1,MAX:1,MID:1,MIN:1,MOD:1,NOT:2,NPV:1,PMT:1,SLA:1,SUM:3,FV:1,LN:1,OR:2,PV:1,"+":1,"-":1,"/":1,"*":1,"<=":1,">=":1,"<>":1,">":1,"<":1,"=":1};if(n)for(var l in n)if(l in a&&(r+=a[l],n.hasOwnProperty(l))){var d=n[l];d-1>3&&(d=3),r+=s[l]*d}return r+=r<2^o?2^o:o},getCumulativeTokenCount:function(e,t){var n=0;return t.forEach(function(t){n+=e[t]?e[t]:0}),n},getIfMaxDepth:function(e){for(var t=maxDepth=0,n=e.length,i="",o=0;o<n;o++)"IF"==e[o]?++t>maxDepth&&(maxDepth=t):"ELSE"==i&&t--,i=e[o];return maxDepth},tokenizeFormula:function(e){return e?this._getPhase2Tokens(this._getPhase1Tokens(e)):[]},_getPhase1Tokens:function(e){var t=[];if(e){var n=["(","["],i=0,o="";for(c of e)n.includes(c)&&i%2==0?(""!=o&&t.push(o),t.push(c),o="",i=0):" "==c&&i%2==0?(""!=o&&t.push(o),o="",i=0):o+=c,"'"==c&&i++;t.push(o)}return t},_getPhase2Tokens:function(e){for(var t="",n=[],i="",o="",r=["CURRENTPERIODSTART","ISFIRSTOCCURRENCE","CURRENTPERIODEND","ISCURRENTVERSION","ISACTUALVERSION","PREVIOUSVERSION","CURRENTVERSION","HALFYEARTODATE","FIRSTNONBLANK","HALFYEARVALUE","QUARTERTODATE","FIRSTNONZERO","LASTNONBLANK","QUARTERVALUE","RANKCUMULATE","ARRIVALRATE","AVGDURATION","DAYSINMONTH","MONTHTODATE","NEXTVERSION","ANSWERTIME","DAYSINYEAR","DECUMULATE","ISANCESTOR","ISNOTBLANK","MONTHVALUE","SUBSTITUTE","WEEKTODATE","YEARTODATE","ADDMONTHS","MOVINGSUM","WEEKVALUE","YEARVALUE","ADDYEARS","CUMPRINC","CUMULATE","ERLANG-B","ERLANG-C","FINDITEM","INPERIOD","MAKELINK","PREVIOUS","TEXTLIST","AGENTSB","AVGWAIT","COLLECT","COMPARE","CUMIPMT","ISBLANK","PROFILE","TIMESUM","WEEKDAY","AGENTS","DIVIDE","LENGTH","LOOKUP","MAILTO","MROUND","OFFSET","PARENT","PERIOD","SELECT","SPREAD","BLANK","LOWER","MONTH","POWER","RIGHT","ROUND","START","UPPER","VALUE","CODE","DATE","DAYS","FIND","IPMT","ITEM","LEAD","LEFT","NAME","NEXT","NPER","POST","PPMT","RANK","RATE","SIGN","SQRT","TEXT","TRIM","YEAR","ABS","AND","DAY","END","EXP","IRR","LAG","LEN","LOG","MAX","MID","MIN","MOD","NOT","NPV","PMT","SLA","SUM","FV","LN","OR","PV","+","-","/","*","<=",">=","<>",">","<","=","IF","THEN","ELSE","TRUE","FALSE","AND","NOT","OR","&"],a=["(",")","[","]",",",":"],s=0,l=e.length;s<l;s++)(o=e[s]).length>2&&"()"==o.substr(o.length-2)&&(i="()",o=o.substr(0,o.length-2)),a.includes(o.charAt(0))&&(i=o.charAt(0),o=o.substr(1)),a.includes(o.charAt(o.length-1))&&(i=o.charAt(o.length-1),o=o.substr(0,o.length-1)),""==i?" "==o||!r.includes(o)&&isNaN(o)?(""!=t&&(t+=" "),t+=o):(""!=t&&(n.push(t),t=""),n.push(o)):(" "==o||!r.includes(o)&&isNaN(o)?(""!=t&&(t+=" "),t+=o,n.push(t)):(""!=t&&n.push(t),""!=o&&n.push(o)),n.push(i),t="",i="");return""!=t&&n.push(t),n},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},tagTokensInFormula:function(e,t){JSON.stringify(t);for(var n=["OR","AND","NOT"],i=["TRUE","FALSE"],o=["CURRENTPERIODSTART","ISFIRSTOCCURRENCE","CURRENTPERIODEND","ISCURRENTVERSION","ISACTUALVERSION","PREVIOUSVERSION","CURRENTVERSION","HALFYEARTODATE","FIRSTNONBLANK","HALFYEARVALUE","QUARTERTODATE","FIRSTNONZERO","LASTNONBLANK","QUARTERVALUE","RANKCUMULATE","ARRIVALRATE","AVGDURATION","DAYSINMONTH","MONTHTODATE","NEXTVERSION","ANSWERTIME","DAYSINYEAR","DECUMULATE","ISANCESTOR","ISNOTBLANK","MONTHVALUE","SUBSTITUTE","WEEKTODATE","YEARTODATE","ADDMONTHS","MOVINGSUM","WEEKVALUE","YEARVALUE","ADDYEARS","CUMPRINC","CUMULATE","ERLANG-B","ERLANG-C","FINDITEM","INPERIOD","MAKELINK","PREVIOUS","TEXTLIST","AGENTSB","AVGWAIT","COLLECT","COMPARE","CUMIPMT","ISBLANK","PROFILE","TIMESUM","WEEKDAY","AGENTS","DIVIDE","LENGTH","LOOKUP","MAILTO","MROUND","OFFSET","PARENT","PERIOD","SELECT","SPREAD","LOWER","MONTH","POWER","RIGHT","ROUND","START","UPPER","VALUE","CODE","DATE","DAYS","FIND","IPMT","ITEM","LEAD","LEFT","NAME","NEXT","NPER","POST","PPMT","RANK","RATE","SIGN","SQRT","TEXT","TRIM","YEAR","ABS","AND","DAY","END","EXP","IRR","LAG","LEN","LOG","MAX","MID","MIN","MOD","NOT","NPV","PMT","SLA","SUM","FV","LN","OR","PV"],r=["<=",">=","<>",">","<","="],a=["SELECT","LOOKUP","MIN","MAX","AVG","TEXTLIST","SUM"],s=["IF","THEN","ELSE"],l=[],d=[],u=!1,c=!1,h=0,p=e.length;h<p;h++)token=e[h],length=token.length,type="unknown",use="unknown",0!=token.length&&(u?(u=!1,use="dimension_mapping",tokenBeforeColon=e[h-2],"SELECT"==tokenBeforeColon?type="item/top_level/time":type="line_item/property"):":"==token?(u=!0,type="mapping_seperator"):"("==token?0==h||tokenWithTags[h-1]&&tokenWithTags[h-1].type&&"function"!=tokenWithTags[h-1].type?(type="grouping_start",d.push("group")):(type="function_param_start",d.push("function")):")"===token?"group"==d.pop()?type="grouping_end":type="function_param_end":n.includes(token)?type="boolean_operator":r.includes(token)?type="comparison":"["==token?(type="mapping_start",c=!0):"]"==token?(type="mapping_end",c=!1):","==token?type="seperator":c&&a.includes(token)?type="mapping_operator":o.includes(token)?type="function":i.includes(token)?type="boolean_constant":"BLANK"==token?type="entity/time constant":'"'==token[0]?type="string_constant":_e.isNumeric(token)?type="numeric_constant":s.includes(token)?type="if_then_else":(lenFunctionGroupStack=d.length,lenFunctionGroupStack>0&&"function"==d[lenFunctionGroupStack-1]?(functionName=e[h-2],"ITEM"!=functionName&&"FINDITEM"!=functionName||(type="list",use="list")):(type="line_item/property/item",use="value")),tokenWithTags={token:token,type:type,use:use},l.push(tokenWithTags));return l}},be=x([G,B,T],{frameworkServices:null,title:"Model Analysis",constructor:function(e){this._pasteSpecial=null},destroy:function(){this._main&&this._main.destroyRecursive()},show:function(e){var i;"FULL_ACCESS"!==n.getUserInfo().loggedInUserCurrentModelRole&&W.publish("anaplan/systemmessage","To obtain most accurate results you should be FULL_ACCESS!",null,-1,t.SYSTEM_MESSAGE_WARN),e?(i=new Te({frameworkServices:this.frameworkServices,title:this.title}),this.frameworkServices.showAsPopup(i)):(i=new Te({frameworkServices:this.frameworkServices,region:"center",title:this.title}),this.frameworkServices.showInSitu(i)),i.set("pasteSpecial",this._pasteSpecial),this.own(i.on("pasteSpecial",function(e){this._pasteSpecial=e}.bind(this))),this.own(i.on("navigate",function(e){this.emit("navigate",e)}.bind(this))),this._main=i}});w.byId("framework")&&w.byId("framework").register(new be({}))}),require(["anaplan/api/Fetchers/Base/Fetchable","anaplan/api/Fetchers/dashboards","anaplan/api/Fetchers/modules","anaplan/constants","anaplan/data/Aggregator","anaplan/data/ChangeFactory","anaplan/data/ModelContentCache","anaplan/data/ModelContentHelper","anaplan/data/RequestFactory","anaplan/formula/DataReference","anaplan/modelmap/data/ModelMapStore","anaplan/utils/AxisHelper","anaplan/utils/EntityLongIdHelper","anaplan/utils/FormatHelper","anaplan/utils/SubmissionHandler","anaplan/utils/UIHelper","anaplan/widgets/SearchBarFull","dgrid/extensions/ColumnHider","dgrid/extensions/ColumnReorder","dgrid/extensions/ColumnResizer","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/_Container","dijit/_WidgetBase","dijit/Destroyable","dijit/form/Button","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","dijit/layout/StackController","dijit/registry","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/Evented","dojo/on","dojo/query","dojo/Stateful","dojo/store/Memory","dojo/topic"],function(e,t,n,i,o,r,a,s,l,d,u,c,h,p,m,g,f,E,I,y,T,_,b,S,L,C,N,A,R,v,O,P,w,D,M,x,k,Y,F,H,B,U,V){var G=function(e,t){var n=[];if(e&&e.length){for(var i=!1,o=0,r=0;o<e.length;)"'"===e.charAt(o)?"'"===e.charAt(o+1)?o+=2:(i=!i,o+=1):(i||e.charAt(o)!==t||(n.push(e.substring(r,o).trim()),r=o+1),o+=1);n.push(e.substring(r).trim())}return n},j=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_ACTION_WITH_HEADING_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_ACTION_PROPERTY_IDENTIFIER}}),X=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_HIERARCHY_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_HIERARCHY_PROPERTY_IDENTIFIER}}),W=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_DATA_SOURCE_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_DATA_SOURCE_DETAILS_PROPERTY_IDENTIFIER}}),q=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_ALL_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_DEFINITION_PROPERTY_IDENTIFIER}}),K=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_ALL_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_IMPORT_PROPERTY_IDENTIFIER}}),z=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_MODULE_WITH_LINE_ITEM_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_LINE_ITEM_PROPERTY_IDENTIFIER}}),J=M(e,{axesIdentifiers:{rows:i.SYSTEM_AXIS_IDENTIFIER_PROCESS_IDENTIFIER,columns:i.SYSTEM_AXIS_IDENTIFIER_PROCESS_PROPERTY_IDENTIFIER}}),Q=(M([B,Y],{dataPages:null,columnCount:-1,columnLabelPages:null,rowCount:-1,rowLabelPages:null,serialNumbers:null,viewDefinition:null,viewIndex:-1,destroy:function(){o.deleteObserver(this)},startup:function(){o.addObserver(this)},error:function(e){console.error(this.viewDefinition,e)},update:function(e){var t=e[0];this.viewDefinition=t.viewDefinition,this.viewIndex=t.viewIndex,this.rowCount=t.rowCount,this.columnCount=t.columnCount;var n=!1;this.serialNumbers.rowAxisSerialNumber!==t.serialNumbers.rowAxisSerialNumber&&(n=null===this.rowLabelPages||JSON.stringify(t.rowLabelPages[0].labels[0])!==JSON.stringify(this.rowLabelPages[0].labels[0]),this.rowLabelPages=t.rowLabelPages),this.serialNumbers.columnAxisSerialNumber!==t.serialNumbers.columnAxisSerialNumber&&(this.columnLabelPages=t.columnLabelPages),this.serialNumbers.dataSerialNumber!==t.serialNumbers.dataSerialNumber&&(n=n||null===this.dataPages||JSON.stringify(t.dataPages[0])!==JSON.stringify(this.dataPages[0]),this.dataPages=t.dataPages),this.serialNumbers=t.serialNumbers,n&&this.emit("load",this)},view:function(){return l.createRequest(window.workspaceId,[],[this])}}),M([B],{actions:null,dashboards:null,hierarchies:null,modules:null,imports:null,importDataSources:null,importDefinitions:null,lineItems:null,processes:null,load:function(){var e=(new Date).getTime();return new m({showPleaseWait:!1}).post([],[(new X).buildViewRequest(),n.buildViewRequest(),t.buildViewRequest(),(new j).buildViewRequest(),(new W).buildViewRequest(),(new J).buildViewRequest(),(new q).buildViewRequest(),(new K).buildViewRequest(),(new z).buildViewRequest()]).then(function(t){var n=t.result.viewRequestResults;console.log("loaded",(new Date).getTime()-e+"ms",n.length,"view request results"),e=(new Date).getTime(),this._extractHierarchies(n.shift()),this._extractModules(n.shift()),this._extractDashboards(n.shift()),this._extractActions(n.shift()),this._extractImportDataSources(n.shift()),this._extractProcesses(n.shift()),this._extractImports(n.shift()),this._extractImportDefinitions(n.shift()),this._extractLineItems(n.shift()),console.log("extracted",(new Date).getTime()-e+"ms"),e=(new Date).getTime(),this._resolveReferences(),console.log("resolved references",(new Date).getTime()-e+"ms")}.bind(this))},_extractActions:function(e){var t=[];if(e.rowCount){for(var n,o=e.columnLabelPages[0].entityLongIds[0],r=[i.SYSTEM_PROPERTY_USED_BY_DASHBOARDS,i.SYSTEM_PROPERTY_USED_BY_PROCESSES].map(function(e){return o.indexOf(e)}),a=e.dataPages[0].cellValues,s=e.rowLabelPages[0].entityLongIds[0],l=e.rowLabelPages[0].labels[0],u={112:"I",116:"E",117:"A",118:"P"},c=new d,p=0;p<e.rowCount;p++)h.getEntityTypeIndex(s[p])!==i.ACTION_GROUPING_ENTITY_TYPE_INDEX&&(n=p*e.columnCount,t.push({id:s[p],type:u[String(h.getEntityTypeIndex(s[p]))]||h.getEntityTypeIndex(s[p]),entityLongId:s[p],label:l[p],singlePartIdentifier:c.generateSinglePartIdentifier(l[p]),_usedInDashboards:a[n+r[0]],_usedInProcesses:a[n+r[1]]}));this.set("actions",t)}else this.set("actions",[])},_extractDashboards:function(e){if(!e.rowCount)return this.set("dashboards",[]),[];for(var t=[],n=e.columnLabelPages[0].entityLongIds[0],o=[i.SYSTEM_PROPERTY_DASHBOARD_REFERENCED_MODULES].map(function(e){return n.indexOf(e)}),r=e.dataPages[0].cellValues,a=e.rowLabelPages[0].entityLongIds[0],s=e.rowLabelPages[0].labels[0],l=new d,u=0;u<e.rowCount;u++){var c=u*e.columnCount;t.push({id:a[u],entityLongId:a[u],label:s[u],singlePartIdentifier:l.generateSinglePartIdentifier(s[u]),_usedModules:r[c+o[0]]})}this.set("dashboards",t)},_extractHierarchies:function(e){for(var t,n=[],o=e.columnLabelPages[0].entityLongIds[0],r=[i.SYSTEM_PROPERTY_USED_IN_APPLIES_TO,i.SYSTEM_PROPERTY_USED_AS_FORMAT,i.SYSTEM_PROPERTY_USED_IN_FORMULA,i.SYSTEM_PROPERTY_HIERARCHY_ITEM_COUNT,i.SYSTEM_PROPERTY_HIERARCHY_SUBSETS].map(function(e){return o.indexOf(e)}),a=e.dataPages[0].cellValues,s=e.rowLabelPages[0].entityLongIds[0],l=e.rowLabelPages[0].labels[0],u=new d,c=0;c<e.rowCount;c++)t=c*e.columnCount,n.push({id:s[c],entityLongId:s[c],label:l[c],itemCount:a[t+r[3]],singlePartIdentifier:u.generateSinglePartIdentifier(l[c]),_referencedInAppliesTo:a[t+r[0]],_referencedAsFormat:a[t+r[1]],_referencedInFormula:a[t+r[2]],_subsets:a[t+r[4]]});this.set("hierarchies",n)},_extractImportDataSources:function(e){if(e.rowCount){for(var t=[],n=e.columnLabelPages[0].entityLongIds[0],o=[i.SYSTEM_PROPERTY_IMPORT_DATA_SOURCE_IMPORTS,4000002501,4000002502,4000002503].map(function(e){return n.indexOf(e)}),r=e.dataPages[0].cellValues,a=e.rowLabelPages[0].entityLongIds[0],s=e.rowLabelPages[0].labels[0],l=new d,u=0;u<e.rowCount;u++){var c=u*e.columnCount;t.push({id:a[u],entityLongId:a[u],label:s[u],singlePartIdentifier:l.generateSinglePartIdentifier(s[u]),sourceModel:r[c+o[1]],sourceType:r[c+o[2]],sourceObjectName:r[c+o[3]],_imports:r[c+o[0]]})}this.set("importDataSources",t)}else this.set("importDataSources",[])},_extractImports:function(e){if(e.rowCount){for(var t=[],n=e.columnLabelPages[0].entityLongIds[0],o=[i.SYSTEM_PROPERTY_IMPORT_SOURCE_LABEL,i.SYSTEM_PROPERTY_IMPORT_TARGET_NAME].map(function(e){return n.indexOf(e)}),r=e.dataPages[0].cellValues,a=e.rowLabelPages[0].entityLongIds[0],s=e.rowLabelPages[0].labels[0],l=new d,u=0;u<e.rowCount;u++){var c=u*e.columnCount;t.push({type:"I",entityLongId:a[u],label:s[u],singlePartIdentifier:l.generateSinglePartIdentifier(s[u]),sourceLabel:r[c+o[0]],targetName:r[c+o[1]]})}this.set("imports",t)}else this.set("imports",[])},_extractImportDefinitions:function(e){if(e.rowCount){for(var t=[],n=e.columnLabelPages[0].entityLongIds[0],o=[i.SYSTEM_PROPERTY_IMPORT_DEFINITION].map(function(e){return n.indexOf(e)}),r=e.dataPages[0].cellValues,a=e.rowLabelPages[0].entityLongIds[0],s=e.rowLabelPages[0].labels[0],l=new d,u=0;u<e.rowCount;u++){var c=u*e.columnCount;t.push({entityLongId:a[u],label:s[u],singlePartIdentifier:l.generateSinglePartIdentifier(s[u]),importDefinition:JSON.parse(r[c+o[0]],null,2)})}this.set("importDefinitions",t)}else this.set("importDefinitions",[])},_extractLineItems:function(e){if(e.rowCount){var t,n=e.rowLabelPages[0],o=[],r=new d;n.entityLongIds[0].forEach(function(e,a){h.getEntityTypeIndex(e)===i.MODULE_ENTITY_TYPE_INDEX?t=n.labels[0][a]:o.push({entityLongId:e,label:n.labels[0][a],module:t,twoPartIdentifier:r.generateTwoPartIdentifier(t,n.labels[0][a])})}),this.set("lineItems",o)}else this.set("lineItems",[])},_extractModules:function(e){if(e.rowCount){for(var t=[],n=e.columnLabelPages[0].entityLongIds[0],o=[i.SYSTEM_PROPERTY_APPLIES_TO,4000000356,i.SYSTEM_PROPERTY_MANAGED_IN,i.SYSTEM_PROPERTY_REFERENCED_BY,i.SYSTEM_PROPERTY_USED_BY_DASHBOARDS,i.SYSTEM_PROPERTY_MODULE_LINE_ITEMS].map(function(e){return n.indexOf(e)}),r=e.dataPages[0].cellValues,a=e.rowLabelPages[0].entityLongIds[0],s=e.rowLabelPages[0].labels[0],l=new d,u=0;u<e.rowCount;u++){var c=u*e.columnCount;t.push({id:a[u],entityLongId:a[u],label:s[u],cellCount:Number(r[c+o[1]]),managedBy:r[c+o[2]],singlePartIdentifier:l.generateSinglePartIdentifier(s[u]),_appliesTo:r[c+o[0]],_lineItems:r[c+o[5]],_referencedBy:r[c+o[3]],_usedInDashboards:r[c+o[4]]})}this.set("modules",t)}else this.set("modules",[])},_extractProcesses:function(e){var t=[];if(e.rowCount){for(var n,i=e.dataPages[0].cellValues,o=e.rowLabelPages[0].entityLongIds[0],r=e.rowLabelPages[0].labels[0],a=new d,s=0;s<e.rowCount;s++)n=s*e.columnCount,t.push({type:"P",entityLongId:o[s],label:r[s],processDefinitionJson:i[n],singlePartIdentifier:a.generateSinglePartIdentifier(r[s])});this.set("processes",t)}else this.set("processes",[])},_extractProcessNodes:function(e){for(var t,n=[],i=e.start;i&&"_END_"!==i&&(t=e.nodes[i]);)t.action&&n.push(h.entityLongIdIdentifierToEntityLongId(t.action)),i=t.next;return n},_labelPageToObjArr:function(e){if(!e.count)return[];var t=e.entityLongIds[0],n=e.labels[0],i=new d;return t.map(function(e,t){return{entityLongId:e,label:n[t],singlePartIdentifier:i.generateSinglePartIdentifier(n[t])}})},_reduceMap:function(e,t){return e.filter(function(e){return e[t]&&e[t].length}).reduce(function(e,n){return n[t].forEach(function(t){(e[t.label]=e[t.label]||[]).push({entityLongId:n.entityLongId,label:n.label})}),e},{})},_resolveReferences:function(){var e,t,n,o,r,l,u=this.get("actions"),c=this.get("dashboards"),m=new d,g=this.get("hierarchies"),f=this.get("imports"),E=this.get("importDataSources"),I=this.get("lineItems"),y=this.get("modules"),T=this.get("processes"),_=g.reduce(function(t,n){return(e=a.getHierarchyInfo(n.entityLongId)).propertiesLabelPage.count&&t.push.apply(t,e.propertiesLabelPage.labels.map(function(t,i){return{entityLongId:e.propertiesLabelPage.entityLongIds[i],twoPartIdentifier:m.generateTwoPartIdentifier(n.label,t)}})),t},[]),b=this._labelPageToObjArr(a.getHierarchySubsetsLabelPage()),S=a.getViewsInfo(),L=a.getModulesLabelPage(),C=[_,I,S.moduleEntityLongIds.map(function(e,i){return t=L.labels[0][L.entityLongIds[0].indexOf(e)],n=S.viewsLabelPage.labels[0][i],{entityLongId:S.viewsLabelPage.entityLongIds[0][i],twoPartIdentifier:m.generateTwoPartIdentifier(t,n)}},{})].reduce(function(e,t,n){return t.forEach(function(t){e[t.twoPartIdentifier]=t.entityLongId}),e},{});[g,b,y,c,u,T].reduce(function(e,t){return t.forEach(function(t){e[t.label]=t.entityLongId,e[t.singlePartIdentifier]=t.entityLongId}),e},C),g=(g=g.map(function(t){return t.referencedInAppliesTo=this._toObjArr(t._referencedInAppliesTo,C),t.referencedAsFormat=this._toObjArr(t._referencedAsFormat,C),t.referencedInFormula=this._toObjArr(t._referencedInFormula,C),t.subsets=this._toObjArr(t._subsets,C),e=a.getHierarchyInfo(t.entityLongId),t.isNumberedList=e.isNumberedList,t.hasSelectiveAccess=e.hasSelectiveAccess,t.properties=e.propertiesLabelPage.entityLongIds.map(function(t,n){return{entityLongId:t,label:e.propertiesLabelPage.labels[n]}}),O=[],t.isNumberedList&&O.push("#"),t.hasSelectiveAccess&&O.push("*"),t.decoration=O,t.isTargetOf=f.filter(function(e){return e.targetName===t.label}).map(function(e){return e}),t.refInAppliesToCount=t.referencedInAppliesTo.length,t.refInFormulaCount=t.referencedInFormula.length,t}.bind(this))).concat(b),this.set("hierarchies",g);c=c.map(function(e){return(r=a.getDashboardInfo(e.entityLongId))&&r.dashboardDefinitionJsonString&&r.dashboardDefinitionJsonString.length?(o=JSON.parse(r.dashboardDefinitionJsonString),e.elementCount=o.dashboardElements.length,l=o.dashboardElements.filter(function(e){return e.hasOwnProperty("viewDefinition")&&null!==e.viewDefinition}).map(function(e){return e.viewDefinition}),e.filteredAxisCount=l.map(function(e){return function(e){var t=[];return x.exists("rowAxisSpecification.axisDefinition",e)&&t.push(e.rowAxisSpecification),x.exists("columnAxisSpecification.axisDefinition",e)&&t.push(e.columnAxisSpecification),x.exists("pageAxisSpecifications",e)&&t.push.apply(t,e.pageAxisSpecifications),t}(e)}).reduce(function(e,t){return e+t.reduce(function(e,t){return e+(s.axisSpecificationContainsSortAndFilterDefinition(t)?1:0)},0)},0),e.viewCount=l.length):(e.elementCount=0,e.filteredAxisCount=0,e.viewCount=0),e}),this.set("dashboards",c);var N,A,R,v,O,P,w,D,M=g.reduce(function(e,t){return e[String(t.entityLongId)]=t,e},{});y=y.map(function(e){return e.usedInDashboards=this._toObjArr(e._usedInDashboards,C),e.usedInDashboardsCount=e.usedInDashboards.length,e.appliesTo=this._toObjArr(e._appliesTo,C),e.referencedBy=this._toObjArr(e._referencedBy,C),e.referencedByCount=e.referencedBy.length,null!==(N=a.getModuleInfo(e.entityLongId))?(A=N.lineItemInfos,R=N.lineItemsLabelPage.labels[0],e.lineItems=N.lineItemsLabelPage.entityLongIds[0].map(function(e,t){return v=A[t].format,O=v.dataType===i.dataTypes.NONE?[]:[v.dataType.split("_").reduce(function(e,t){return e=e.concat(t[0].toLowerCase())},[]).join("")],v.dataType===i.dataTypes.ENTITY&&(v.entityFormatFilter&&O.push("ef"),!0===v.selectiveAccessApplied&&O.push("sa"),P=g.filter(function(e){return e.entityLongId===Number(v.hierarchyEntityLongId)})[0],O.push(P&&P.hasOwnProperty("itemCount")?p.formatCellCount(P.itemCount).replace("cells","items"):"?")),{entityLongId:e,label:R[t],decoration:O}}),e.lineItemsCount=e.lineItems.length,e._fullAppliesTo=N.fullAppliesTo,e.fullAppliesTo=e._fullAppliesTo.map(function(e){return M.hasOwnProperty(String(e))?(w=M[String(e)].label,D=M[String(e)].decoration||[]):(w=s.getLabelForDimensionIdentifier(a,h.entityLongIdToEntityLongIdIdentifier(e)),D=[]),{entityLongId:e,label:w+D.map(function(e){return"("+e+")"}).join("")}}),e.fullAppliesToCount=e.fullAppliesTo.length):(console.log("_resolveReferences model role does not have access to module?",e.label),e.lineItems=[],e.lineItemsCount=-1,e.fullAppliesTo=e._fullAppliesTo=[],e.fullAppliesToCount=-1),e.isTargetOf=f.filter(function(t){return t.targetName===e.label}).map(function(e){return e}),e}.bind(this)),this.set("modules",y);var k=E.reduce(function(e,t){return e[String(t.label)]=t,e},{});f.forEach(function(e){e.source=k[e.sourceLabel]||null}),this.set("imports",f);var Y=f.reduce(function(e,t){return(e[String(t.sourceLabel)]=e[String(t.sourceLabel)]||[]).push({entityLongId:t.entityLongId,label:t.label}),e},[]);E.forEach(function(e){e.imports=Y[String(e.label)]||[],e.sourceObject=[],"-"===e.sourceModel&&["LIST","MODULE","SAVED VIEW"].indexOf(e.sourceType)>-1&&(C[e.sourceObjectName]?e.sourceObject.push({label:e.sourceObjectName,entityLongId:C[e.sourceObjectName]}):console.log("_resolveReferences failed to find",e.sourceObjectName,Object.keys(C)))}),this.set("importDataSources",E);var F,H=f.reduce(function(e,t){return e[String(t.entityLongId)]=t,e},{}),B=u.reduce(function(e,t){return e[t.entityLongId]=t.label,e},{}),U=T.reduce(function(e,t){return e[t.entityLongId]=t.processDefinitionJson&&t.processDefinitionJson.length?JSON.parse(t.processDefinitionJson):null,e},{});u=u.map(function(e){return e.usedInDashboards=this._toObjArr(e._usedInDashboards,C),e.usedInDashboardsCount=e.usedInDashboards.length,e.usedInProcesses=this._toObjArr(e._usedInProcesses,C),e.usedInProcessesCount=e.usedInProcesses.length,h.getEntityTypeIndex(e.entityLongId)===i.IMPORT_ENTITY_TYPE_INDEX&&(e.source=[H[String(e.entityLongId)].source]),h.getEntityTypeIndex(e.entityLongId)===i.PROCESS_ENTITY_TYPE_INDEX&&(e.nodes=U.hasOwnProperty(e.entityLongId)?this._extractProcessNodes(U[e.entityLongId]).map(function(e){return{entityLongId:e,label:B[e]}}):[]),h.getEntityTypeIndex(e.entityLongId)===i.ACTION_ENTITY_TYPE_INDEX&&(F=a.getActionInfo(e.entityLongId))&&F.actionDefinitionJsonString&&F.actionDefinitionJsonString.length&&(e.actionDefinition=JSON.parse(F.actionDefinitionJsonString)),e}.bind(this)),this.set("actions",u);var V=this._reduceMap(u,"usedInDashboards");c=c.map(function(e){return e.usedModules=this._toObjArr(e._usedModules,C),e.usedModulesCount=e.usedModules.length,e.actions=V.hasOwnProperty(e.label)?V[e.label]:[],e.actionsCount=e.actions.length,e}.bind(this)),this.set("dashboards",c)},_toObjArr:function(e,t){return e&&e.length?G(e,",").map(function(e){return e.trim()}).map(function(e){return t.hasOwnProperty(e)?{entityLongId:t[e],label:e}:(console.log("toObjArr failed to find",e,Object.keys(t)),e)}):[]}})),Z=M([u,B],{modelDataLoader:null,queryTargets:null,constructor:function(){this.actions=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("actions"),i.ACTION_ENTITY_TYPE_INDEX)),this.dashboards=this._reduceMap(this.modelDataLoader.get("dashboards")),this.exports=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("actions"),i.EXPORT_ENTITY_TYPE_INDEX)),this.hierarchies=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("hierarchies"),i.HIERARCHY_ENTITY_TYPE_INDEX)),this.hierarchySubsets=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("hierarchies"),i.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX)),this.imports=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("actions"),i.IMPORT_ENTITY_TYPE_INDEX)),this.modules=this._reduceMap(this.modelDataLoader.get("modules")),this.processes=this._reduceMap(this._filterByEntityTypeIndex(this.modelDataLoader.get("actions"),i.PROCESS_ENTITY_TYPE_INDEX))},_filterByEntityTypeIndex:function(e,t){return e.filter(function(e){return h.getEntityTypeIndex(e.entityLongId)===t})},_find:function(e){return this.queryTargets.map(function(t){return this._filterList(e,t[0].toUpperCase()+t.substring(1),this[t])}.bind(this)).filter(function(e){return e.results.length})},_reduceMap:function(e){return e.reduce(function(e,t){return e[t.label]={id:String(t.entityLongId),label:t.label},e},{})}}),$=M([b,_,S,E,I,y,T]),ee=M([O,Y],{actions:null,iconClass:"anaplanEditorIcon anaplanEditorIconRunImport",queryTargets:["actions","imports","exports","processes","dashboards"],title:"Actions",postCreate:function(){var e=new $({columns:[{field:"type",label:"",width:16},{field:"label",label:"Label",width:200},{field:"usedInDashboardsCount",label:"Used In Dashboards Count",width:50,sortable:!0},{field:"usedInProcessesCount",label:"Used In Processes Count",width:50,sortable:!0},{field:"usedModulesCount",label:"Used Modules Count",width:50,sortable:!0},{field:"_usedInDashboards",label:"Used In Dashboards",width:120,sortable:!1,hidden:!0},{field:"_usedInProcesses",label:"Used In Processes",width:120,sortable:!1,hidden:!0}],selectionMode:"single",store:new U({data:this.actions.sort(function(e,t){return e.usedInDashboardsCount===t.usedInDashboardsCount?e.label<t.label?-1:1:e.usedInDashboardsCount<t.usedInDashboardsCount})})});this.addChild(e),this.own(e.on("dgrid-select",function(e){this.emit("select",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=e},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)}}),te=M([O,Y],{dashboards:null,iconClass:"anaplanEditorIcon anaplanEditorIconDashboard",queryTargets:["dashboards","modules","actions","imports","processes"],title:"Dashboards",postCreate:function(){var e=new $({columns:[{field:"label",label:"Dashboard",width:120,sortable:!0},{field:"elementCount",label:"Element Count",width:50,sortable:!0},{field:"viewCount",label:"View Count",width:50,sortable:!0},{field:"filteredAxisCount",label:"Filtered Axis Count",width:50,sortable:!0},{field:"actionsCount",label:"Actions Count",width:50,sortable:!0},{field:"usedModulesCount",label:"Used Modules Count",width:50,sortable:!0},{field:"_usedModules",label:"Used Modules",width:120,sortable:!1,hidden:!0}],selectionMode:"single",store:new U({data:this.dashboards.sort(function(e,t){return e.elementCount===t.elementCount?e.label<t.label?-1:1:e.elementCount<t.elementCount})})});this.addChild(e),this.own(e.on("dgrid-select",function(e){this.emit("select",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=e},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)}}),ne=M([O,Y],{hierarchies:null,iconClass:"anaplanEditorIcon anaplanEditorIconListsAndRollups",queryTargets:["hierarchies","hierarchySubsets","modules"],title:"Hierarchies",postCreate:function(){var e=new $({columns:[{field:"label",label:"Hierarchy",width:120,sortable:!0},{field:"itemCount",label:"Item Count",width:60,sortable:!0,renderCell:function(e,t,n,i){t&&n.appendChild(document.createTextNode(p.formatCellCount(t).replace("cells","items")))}},{field:"hasSelectiveAccess",label:"Sel Acc",width:18,sortable:!0,renderCell:function(e,t,n,i){t&&n.appendChild(document.createTextNode("*"))}},{field:"isNumberedList",label:"Num List",width:18,sortable:!0,renderCell:function(e,t,n,i){t&&n.appendChild(document.createTextNode("#"))}},{field:"refInAppliesToCount",label:"Ref In Applies To Count",width:50,sortable:!0},{field:"refInFormulaCount",label:"Ref In Formula Count",width:50,sortable:!0},{field:"subsets",label:"Subsets",width:120,renderCell:function(e,t,n,i){if(t&&t.length){var o,r=document.createElement("ul");r.style.listStyle="none",r.style.margin=0,r.style.padding=0,t.forEach(function(e){(o=document.createElement("li")).appendChild(document.createTextNode(e.label)),r.appendChild(o)}),n.appendChild(r)}}},{field:"_referencedInAppliesTo",label:"Referenced In Applies To",width:120,sortable:!1,hidden:!0},{field:"referencedAsFormat",label:"Referenced As Format",width:120,sortable:!1,hidden:!0}],selectionMode:"single",store:new U({data:this.hierarchies.filter(function(e){return h.getEntityTypeIndex(e.entityLongId)===i.HIERARCHY_ENTITY_TYPE_INDEX}).sort(function(e,t){return e.itemCount===t.itemCount?e.label<t.label?-1:1:e.itemCount<t.itemCount})})});this.addChild(e),this.own(e.on("dgrid-select",function(e){this.emit("select",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=e},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)}}),ie=M([O,Y],{iconClass:"anaplanEditorIcon anaplanEditorIconModule",modules:null,queryTargets:["modules","hierarchies","hierarchySubsets"],title:"Modules",postCreate:function(){var e=new $({columns:[{field:"label",label:"Module",width:120},{field:"cellCount",label:"Cell Count",width:60,sortable:!0,renderCell:function(e,t,n,i){t&&n.appendChild(document.createTextNode(p.formatCellCount(t)))}},{field:"lineItemsCount",label:"Line Items Count",width:50,sortable:!0},{field:"fullAppliesToCount",label:"Full Applies To Count",width:50,sortable:!0},{field:"referencedByCount",label:"Ref By Count",width:50,sortable:!0},{field:"usedInDashboardsCount",label:"Used in DBs Count",width:50,sortable:!0},{field:"fullAppliesTo",label:"Full Applies To",width:120,renderCell:function(e,t,n,i){if(t&&t.length){var o,r=document.createElement("ul");r.style.listStyle="none",r.style.margin=0,r.style.padding=0,t.forEach(function(e){(o=document.createElement("li")).appendChild(document.createTextNode(e.label)),r.appendChild(o)}),n.appendChild(r)}}},{field:"_referencedBy",label:"Referenced By",width:120,sortable:!1,hidden:!0},{field:"_usedInDashboards",label:"Used In Dashboards",width:120,sortable:!1,hidden:!0}],selectionMode:"single",store:new U({data:this.modules.sort(function(e,t){return e.cellCount===t.cellCount?e.label<t.label?-1:1:e.cellCount<t.cellCount})})});this.addChild(e),this.own(e.on("dgrid-select",function(e){this.emit("select",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=e},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)}}),oe=M([O,Y],{sources:null,iconClass:"anaplanEditorIcon anaplanEditorIconEdit",queryTargets:["importDataSources","imports"],title:"Sources",postCreate:function(){var e=new $({columns:[{field:"label",label:"Source",width:120,sortable:!0},{field:"sourceModel",label:"Source Model",width:120,sortable:!0},{field:"sourceType",label:"Source Type",width:120,sortable:!0},{field:"sourceObjectName",label:"Source Object Name",width:120,sortable:!0},{field:"imports",label:"Imports",width:120,sortable:!1,renderCell:function(e,t,n,i){if(t&&t.length){var o,r=document.createElement("ul");r.style.listStyle="none",r.style.margin=0,r.style.padding=0,t.forEach(function(e){(o=document.createElement("li")).appendChild(document.createTextNode(e.label)),r.appendChild(o)}),n.appendChild(r)}}}],selectionMode:"single",store:new U({data:this.sources.sort(function(e,t){return e.imports.length===t.imports.length?e.label<t.label?-1:1:e.imports.length<t.imports.length})})});this.addChild(e),this.own(e.on("dgrid-select",function(e){this.emit("select",Number(e.rows[0].data.id))}.bind(this))),this._customGrid=e},getCustomGrid:function(){return this._customGrid},setQuery:function(e){this._customGrid&&this._customGrid.set("query",e)}}),re=M([C,L,Y],{containerId:null,frameworkServices:null,modelDataLoader:null,postCreate:function(){this.inherited(arguments);var e=new w({containerId:this.containerId});this.addChild(e);var t=new A({label:"Copy",style:"padding-left:8px;"});this.addChild(t),this.own(t.on("click",function(){var e=D.byId(this.containerId).selectedChildWidget,t=e.getCustomGrid(),n=t.store.query(t.get("query"),{sort:t.get("sort")}),o=t.subRows[0].filter(function(e){return!e.hidden}),r=(n&&n.length,n.map(function(e){return o.map(function(t){return e[t.field]}).join("\t")}));r.unshift(o.map(function(e){return e.label&&e.label.length?e.label:e.field}).join("\t")),r.unshift([e.title,"for",window.modelName,"copied at",(new Date).toISOString()].join(" ")),this.frameworkServices.doCopy(r).then(function(){V.publish("anaplan/systemmessage",r.length+" lines copied",null,-1,i.SYSTEM_MESSAGE_INFO)})}.bind(this)));var n=new A({disabled:!1,iconClass:"bookmarklet",label:"Bookmark",showLabel:!1,style:"padding-left:8px;"});this.addChild(n),this.own(n.on("click",function(){var e=D.byId(this.containerId).selectedChildWidget,t=e.getCustomGrid(),n=t.store.query(t.get("query"),{sort:t.get("sort")});if(n.length){var i=document.createElement("span");i.appendChild(this._makeIconNode(e.iconClass));var o=document.createElement("span");o.style.display="inline-block",o.style.paddingTop="2px",o.appendChild(document.createTextNode(e.title)),i.appendChild(o);var r=[i.innerHTML];r.push.apply(r,n.map(function(e){return{entityLongId:Number(e.id),label:e.label}})),V.publish("anaplan/bookmark",r)}}.bind(this))),this._bookmarklet=n;var o=new Z({modelDataLoader:this.modelDataLoader,queryTargets:["hierarchies","hierarchySubsets","modules"]}),r=new f({store:o,style:"float:right;"});this.addChild(r),this.own(r.on("selection",function(e){if(e.hasOwnProperty("selection")){var t=e.selection;r.searchBar.textBox.value=t.label,this.emit("query",t)}}.bind(this))),this.own(r.on("cancel",function(){this.emit("cancel")}.bind(this))),this.own(V.subscribe(this.containerId+"-selectChild",function(e){o.set("queryTargets",e.queryTargets)}.bind(this)))},_makeIconNode:function(e){var t=document.createElement("span");return e&&e.length?t.className=e:(t.style.width="16px",t.style.height="16px"),t.style.marginRight="4px",t.style.float="left",t}}),ae=M([C,Y],{baseClass:"panel propertiespanel",properties:null,constructor:function(){this._handles=[],this._started=!1},destroy:function(){this._handles.forEach(function(e){e.remove()})},postCreate:function(){this.inherited(arguments);var e=document.createElement("ul");this.domNode.appendChild(e),this._ul=e},resize:function(e){e&&k.setMarginBox(this.domNode,e)},startup:function(){this.inherited(arguments),this._started=!0,this._renderProperties(this.properties)},_renderProperties:function(e){this._handles.forEach(function(e){e.remove()});for(var t,n=this._ul;n&&n.firstChild;)n.removeChild(n.firstChild);this._started&&null!==e&&(e.forEach(function(e){t=this._makeListItem([this._makeLabel(e.name),this._makeValue(e.value)]),n.appendChild(t)}.bind(this)),this._handles.push(H("a",n).on("click",function(e){var t=e.target;this.emit("navigate",{entityLongId:Number(t.getAttribute("data-entitylongid")),label:t.getAttribute("data-label")})}.bind(this))))},_makeDecoration:function(e){var t=document.createElement("span");return e.forEach(function(e){t.appendChild(document.createTextNode(["(",e,")"].join("")))}),t},_makeExternalLink:function(e){var t=document.createElement("a");return t.title="Goto item",t.style.paddingLeft="4px",t.setAttribute("data-entitylongid",e.entityLongId),t.setAttribute("data-label",e.label),t.appendChild(document.createTextNode("->")),t},_makeLabel:function(e){var t=document.createElement("span");return t.appendChild(document.createTextNode(e)),t},_makeLink:function(e){var t=document.createElement("a");return t.setAttribute("data-entitylongid",e.entityLongId),t.setAttribute("data-label",e.label),t.appendChild(document.createTextNode(e.label)),t},_makeListItem:function(e){var t=document.createElement("li");return t=document.createElement("li"),e.forEach(function(e){t.appendChild(e)}),t},_makeValue:function(e){var t,n,i,o;return Array.isArray(e)?(o=document.createElement("ul"),e.forEach(function(e){t=[],e.hasOwnProperty("entityLongId")?(i=h.getEntityTypeIndex(Number(e.entityLongId)),n=a.getEntityType(i).entityTypeClass,["LINE_ITEM","PROPERTY","SAVED_VIEW"].indexOf(n)>-1?(t.push(this._makeLabel(e.label)),t.push(this._makeDecoration(e.decoration||[])),t.push(this._makeExternalLink(e))):(t.push(this._makeLink(e)),t.push(this._makeDecoration(e.decoration||[])))):(t.push(this._makeLabel(e)),t.push(this._makeDecoration(e.decoration||[]))),o.appendChild(this._makeListItem(t))}.bind(this))):o=this._makeValueLabel(e),o},_makeValueLabel:function(e){var t=this._makeLabel(e);return t.style.marginLeft="auto",t},_setPropertiesAttr:function(e){this._set("properties",e),this._renderProperties(e)}}),se=M([C,L,Y],{baseClass:"viewer dashboardviewer",itemsMap:null,selectedItem:null,constructor:function(){this._handles=[]},postCreate:function(){var e=document.createElement("div");e.style.width="50%",e.classList.add("panel");var t=document.createElement("ol");e.appendChild(t),this._ol=t,this.domNode.appendChild(e);var n=document.createElement("div");n.style.width="50%";var o=document.createElement("div");n.appendChild(o);var l=document.createElement("div");l.style.display="flex";var d=new A({disabled:!0,label:"Save As",style:"margin-left:auto;"}).placeAt(l);n.appendChild(l),this.domNode.appendChild(n),this.containerNode=o,this._toolbar=l,this.own(d.on("click",function(){var e=this._normalisedElement,t=x.clone(e.viewDefinition);t.currentPageIdentifiers=[],t.globalContextIdentifiers=[];var n=s.getModuleEntityIdForViewDefinitionOrReference(a,t),o=this.selectedItem.label+" "+e.layoutPosition+" "+e.dashboardElementType,l={modelId:window.modelId,moduleId:n,modelChangeXml:(new r).getModelChangeGenerator({entityTypeClass:"SAVED_VIEW"}).getModelChangeXml("INSERT",{name:o,moduleId:n,viewDefinition:JSON.stringify(t)})};new m({showPleaseWait:!0}).post([{workspaceId:window.workspaceId,cellChanges:[],modelChanges:[l]}],[],[]).then(function(e){V.publish("anaplan/systemmessage","inserted view "+o,null,-1,i.SYSTEM_MESSAGE_INFO);var t=a.getViewsLabelPage(),n=t.labels[0].indexOf(o);V.publish("anaplan/views",t.entityLongIds[0][n],{})},function(e){console.log(e,o),V.publish("anaplan/systemmessage","failed to insert view",null,-1,i.SYSTEM_MESSAGE_ERROR)})}.bind(this))),this._saveAsButton=d;var u=new ae({});this.addChild(u),this._propertiesPanel=u,this._handles.push(u.on("navigate",function(e){this.emit("navigate",e)}.bind(this))),this._render(this._getNormalisedElements(this.selectedItem))},destroy:function(){this._handles.forEach(function(e){e.remove()})},resize:function(e){e&&(k.setMarginBox(this.domNode,e),this._propertiesPanel&&this._propertiesPanel.resize({h:this._toolbar?e.h-k.getMarginSize(this._toolbar).h:e.h}))},startup:function(){this.inherited(arguments),this._saveAsButton&&this._saveAsButton.startup()},_getActionType:function(e){var t=null;try{var n=this._getActionEntityLongId(e);if(n>-1)switch(h.getEntityTypeIndex(n)){case i.ACTION_ENTITY_TYPE_INDEX:t="OTHER ACTION";break;case i.IMPORT_ENTITY_TYPE_INDEX:t="IMPORT";break;case i.PROCESS_ENTITY_TYPE_INDEX:t="PROCESS"}}catch(e){console.log("DashboardDebugger._getActionType failed returning "+t,e)}return t},_getActionEntityLongId:function(e){var t=-1;try{t=Number(e.taskElements[0].actionEntityLongId)}catch(e){}return t},_getActionLabel:function(e){var t=null;return e>-1&&(t=this.itemsMap.hasOwnProperty(String(e))?this.itemsMap[String(e)].label:e),t},_getAllAxisSpecifications:function(e){return e?[{name:"rows",axisSpecifications:x.exists("rowAxisSpecification.axisDefinition",e)?[e.rowAxisSpecification]:[]},{name:"columns",axisSpecifications:x.exists("columnAxisSpecification.axisDefinition",e)?[e.columnAxisSpecification]:[]},{name:"pages",axisSpecifications:e.pageAxisSpecifications||[]}]:[]},_getCommonProperties:function(e){return[{name:"dashboardElementType",value:e.dashboardElementType},{name:"layoutPosition",value:e.layoutPosition}]},_getDecorationForAxisSpecification:function(e){return[{fx:s.axisSpecificationContainsSortDefinition,decoration:"s"},{fx:s.axisSpecificationContainsSortAndFilterDefinition,decoration:"f"},{fx:s.axisSpecificationContainsSelection,decoration:"sel"},{fx:s.axisSpecificationContainsLevelBasedSelection,decoration:"lbs"},{fx:s.axisSpecificationContainsBranchSync,decoration:"bs"},{fx:s.axisSpecificationContainsAxisOrder,decoration:"ao"}].reduce(function(t,n){return n.fx.bind(s)(e)&&t.push(n.decoration),t},[])},_getDecorationForView:function(e){return Object.keys(this._getAllAxisSpecifications(e).reduce(function(e,t){return e.concat(t.axisSpecifications)},[]).map(function(e){return this._getDecorationForAxisSpecification(e)}.bind(this)).reduce(function(e,t){return t.forEach(function(t){e[t]=t}),e},{}))},_getNormalisedElements:function(e){var t=[],n=D.byId(g.generateId(e.entityLongId));if(n&&n.getChildren().length)try{var i;t=n.getChildren()[0]._dash.getChildren().map(function(e){return i=e.getModel(),{dashboardElementType:e.dashboardElementType,layoutPosition:e.layoutPosition,pageInfo:null===i?null:i.getPageInfo(),viewDefinition:null===i?null:i.getViewDefinition(),columnCount:null===i?-1:i.getColumnCount(),rowCount:null===i?-1:i.getRowCount(),properties:e.jsonProperties?JSON.parse(e.jsonProperties):null}})}catch(t){console.log("_getNormalisedElements failed using widgets",e.label,t)}else try{t=JSON.parse(a.getDashboardInfo(e.entityLongId).dashboardDefinitionJsonString).dashboardElements.map(function(e){return{dashboardElementType:e.dashboardElementType,layoutPosition:e.layoutPosition,pageInfo:null,viewDefinition:e.viewDefinition||null,columnCount:-1,rowCount:-1,properties:e.hasOwnProperty("jsonProperties")?JSON.parse(e.jsonProperties):null}})}catch(t){console.log("_getNormalisedElements failed using elements",e.label,t)}return t.sort(function(e,t){return e.layoutPosition<t.layoutPosition?-1:1})},_getProperties:function(e){var t=e.dashboardElementType,n=this._getCommonProperties(e);if("BUTTON"===t){var i=this._getActionEntityLongId(e.properties);n.push({name:(this._getActionType(e.properties)||"action").toLowerCase(),value:this.itemsMap.hasOwnProperty(String(i))?[{entityLongId:i,label:this._getActionLabel(i)}]:this._getActionLabel(i)})}else e.hasOwnProperty("rowCount")&&e.rowCount>-1&&n.push({name:"rowCount",value:e.rowCount}),e.hasOwnProperty("columnCount")&&e.columnCount>-1&&n.push({name:"columnCount",value:e.columnCount}),n=(n=n.concat(this._getPropertiesForViewDefinition(e.viewDefinition))).concat(this._getPropertiesForAxisSpecifications(e.pageInfo||e.viewDefinition));return n},_getPropertiesForAxisSpecifications:function(e){var t=this.itemsMap;return this._getAllAxisSpecifications(e).map(function(e){return{name:e.name,value:e.axisSpecifications.map(function(e){return s.getAllDimensionIdentifiersForAxisSpecification(e).map(function(n){var i=c.isEmptySystemAxisIdentifier(n),o=i?"Empty":s.getLabelForDimensionIdentifier(a,n),r=i?-1:h.entityLongIdIdentifierToEntityLongId(n),l=i?[]:this._getDecorationForAxisSpecification(e);return t.hasOwnProperty(String(r))?{decoration:l,entityLongId:r,label:o}:o+l.map(function(e){return"("+e+")"})}.bind(this))}.bind(this)).reduce(function(e,t){return e=e.concat(t)},[])}}.bind(this))},_getPropertiesForViewDefinition:function(e){var t=[];if(e.hasOwnProperty("comparisonBase")&&t.push({name:"comparisonBase",value:e.comparisonBase}),e.hasOwnProperty("staticContext")&&e.staticContext.count){var n=e.staticContext.entityLongIds[0],o=h.getEntityTypeIndex(n)===i.MODULE_ENTITY_TYPE_INDEX?s.getModuleLabel(a,n)||n:s.getHierarchyLabel(a,n)||n;t.push({name:"staticContext",value:this.itemsMap.hasOwnProperty(String(n))?[{entityLongId:n,label:o}]:o})}return t},_makeDummyLink:function(e){var t=document.createElement("span"),n=document.createElement("a");return n.setAttribute("data-index",e.index),n.appendChild(document.createTextNode(e.label)),t.appendChild(n),e.decoration&&e.decoration.length&&t.appendChild(this._makeDecoration(e.decoration)),t},_makeDecoration:function(e){var t=document.createElement("span");return e.forEach(function(e){t.appendChild(document.createTextNode(["(",e,")"].join("")))}),t},_makeLabel:function(e){var t=document.createElement("span");return t.appendChild(document.createTextNode(e)),t},_makeLink:function(e){var t=document.createElement("a");return t.setAttribute("data-entitylongid",e.entityLongId),t.setAttribute("data-label",e.label),t.appendChild(document.createTextNode(e.label)),t},_makeListItem:function(e){var t=document.createElement("li");return t=document.createElement("li"),e.forEach(function(e){t.appendChild(e)}),t},_makeValue:function(e){var t,n;return Array.isArray(e)?(t=document.createElement("ul"),e.forEach(function(e){n=e.hasOwnProperty("entityLongId")&&e.hasOwnProperty("label")?[this._makeLink(e)]:[this._makeLabel(e)],e.hasOwnProperty("decoration")&&n.push(this._makeDecoration(e.decoration)),t.appendChild(this._makeListItem(n))}.bind(this))):t=this._makeValueLabel(e),t},_makeValueLabel:function(e){var t=this._makeLabel(e);return t.style.marginLeft="auto",t},_render:function(e){var t,n,i,o,r;e.forEach(function(e,l){switch(t=e.dashboardElementType,n=e.layoutPosition,e.pageInfo,r=e.viewDefinition,i=e.properties,t){case"CELL":case"CHART":case"GRID":case"PAGE_SELECTOR":o=this._makeDummyLink({index:l,label:t+" "+(s.getModuleEntityIdForViewDefinitionOrReference(a,r)||s.getLabelForDimensionIdentifier(a,r.staticContextIdentifiers[0])),decoration:this._getDecorationForView(r)});break;case"BUTTON":o=this._makeDummyLink({index:l,label:this._getActionType(i)||t});break;default:o=this._makeLabel(t)}this._ol.appendChild(this._makeListItem([o,this._makeValueLabel(n)]))}.bind(this)),this._handles.push(H("a",this._ol).on("click",function(t){var n=t.target,i=e[Number(n.getAttribute("data-index"))];this._propertiesPanel.set("properties",this._getProperties(i)),this._saveAsButton.set("disabled",-1===["GRID","CHART"].indexOf(i.dashboardElementType)),this._normalisedElement=i}.bind(this)))},_reset:function(){this._handles.forEach(function(e){e.remove()});for(var e=this._ol;e&&e.firstChild;)e.removeChild(e.firstChild);this._propertiesPanel&&this._propertiesPanel.set("properties",[])}}),le=M([C,L,Y],{baseClass:"viewer viewerwrapper",itemsMap:null,selectedItem:null,constructor:function(){this._handles=[]},destroy:function(){this._handles.forEach(function(e){e.remove()})},resize:function(e){e&&(k.setMarginBox(this.domNode,e),this.getChildren().forEach(function(t){t.resize({h:e.h})}))},_setSelectedItemAttr:function(e){this._set("selectedItem",e),this.getChildren().forEach(function(e){this.removeChild(e),e.destroyRecursive()}.bind(this)),this._handles.forEach(function(e){e.remove()}),null!==e&&this._getChildren(e).forEach(function(e){this.addChild(e),this._handles.push(e.on("navigate",function(e){this.emit("navigate",e)}.bind(this)))}.bind(this))},_getChildren:function(e){var t=h.getEntityTypeIndex(e.entityLongId);return[i.DASHBOARD_ENTITY_TYPE_INDEX].indexOf(t)>-1?[new se({itemsMap:this.itemsMap,selectedItem:e,region:"center"})]:this._getPropertyPanels(t,e)},_getPanelsProperties:function(e,t){return([i.HIERARCHY_ENTITY_TYPE_INDEX,i.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX].indexOf(e)>-1?[["itemCount","hasSelectiveAccess","isNumberedList","properties","subsets","referencedInAppliesTo"],["referencedAsFormat","referencedInFormula","isTargetOf"]]:e===i.MODULE_ENTITY_TYPE_INDEX?[["cellCount","appliesTo","referencedBy","usedInDashboards","isTargetOf"],["lineItems"]]:e===i.IMPORT_DATA_SOURCE_ENTITY_TYPE_INDEX?[["sourceModel","sourceType","sourceObjectName","sourceObject","imports"]]:[["nodes","source","usedInDashboards","usedInProcesses"]]).map(function(e){return e.filter(function(e){return t.hasOwnProperty(e)}).map(function(e){return{name:e,value:t[e]}})}).filter(function(e){return e.length})},_getPropertyPanels:function(e,t){var n=this._getPanelsProperties(e,t);return n.map(function(e){return new ae({properties:e,style:"width:"+Math.min(Math.floor(100/n.length),50)+"%;"})})}}),de=M([R,Y],{entityLongId:-1,label:null,history:[],itemsMap:null,constructor:function(){this._handles=[]},destroy:function(){this._handles.forEach(function(e){e.remove()})},postCreate:function(){this.inherited(arguments);var e=document.createElement("div");e.style.display="flex",e.style.width="100%";var t=document.createElement("div");t.style.width="50%";var n=document.createElement("span");n.style.display="inline-block",n.style.width="16px",n.style.height="16px",t.appendChild(n),this._iconNode=n;var i=document.createElement("h2");i.style.display="inline-block",i.style.paddingLeft="4px",t.appendChild(i);var o=document.createElement("a");o.setAttribute("disabled",!0),o.style.paddingLeft="4px",o.title="Goto item",o.appendChild(document.createTextNode("->")),t.appendChild(o),this.own(F(o,"click",function(e){this._selectedItem&&this.emit("navigate",this._selectedItem)}.bind(this))),this._externalLink=o,e.appendChild(t);var r=document.createElement("div");r.style.width="50%";var s=new A({disabled:!0,iconClass:"bookmarklet",label:"Bookmark",showLabel:!1,style:"padding-left:8px;"}).placeAt(r);this._bookmarklet=s,this.own(s.on("click",function(){V.publish("anaplan/bookmark",[{entityLongId:this.get("entityLongId"),label:this.get("label"),showIconNode:!0}])}.bind(this)));var l=document.createElement("a");l.style.cursor="pointer",l.style.paddingLeft="4px",r.appendChild(l),this.own(F(l,"click",function(e){this.history.length&&this.set("entityLongId",this.history.pop().entityLongId),this.set("history",this.history)}.bind(this))),e.appendChild(r),this._backNav=l,this._heading=i,this._topFlexNode=e,this.domNode.appendChild(e);var d=new le({itemsMap:this.itemsMap});this.addChild(d),this.own(d.on("navigate",function(e){var t=h.getEntityTypeIndex(Number(e.entityLongId)),n=a.getEntityType(t).entityTypeClass;["LINE_ITEM","PROPERTY","SAVED_VIEW"].indexOf(n)>-1?this.emit("navigate",e):this.get("entityLongId")>-1&&(this.history.length&&this.history[this.history.length-1].entityLongId===e.entityLongId?this.history.pop():this.history.push({entityLongId:this.get("entityLongId"),label:this.get("label")}),this.set("entityLongId",e.entityLongId),this.set("history",this.history))}.bind(this))),this._viewerWrapper=d},layout:function(){if(this._contentBox&&this._topFlexNode){var e=this._contentBox.h-k.getMarginSize(this._topFlexNode).h;this._viewerWrapper&&this._viewerWrapper.resize({h:e})}},startup:function(){this.inherited(arguments),this._bookmarklet&&this._bookmarklet.startup()},_getIconClass:function(e){var t;switch(e){case i.MODULE_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconModule";break;case i.DASHBOARD_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconDashboard";break;case i.HIERARCHY_ENTITY_TYPE_INDEX:case i.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconListsAndRollups";break;case i.ACTION_ENTITY_TYPE_INDEX:case i.PROCESS_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIcon anaplanEditorIconRunImport";break;case i.EXPORT_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconExport";break;case i.IMPORT_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconImport";break;case i.IMPORT_DATA_SOURCE_ENTITY_TYPE_INDEX:t="anaplanEditorIcon anaplanEditorIconEdit";break;default:t=""}return t},_setHistoryAttr:function(e){this._set("history",e),this._backNav&&(this._backNav.firstChild&&this._backNav.removeChild(this._backNav.firstChild),e&&e.length&&this._backNav.appendChild(document.createTextNode("Back to "+e[e.length-1].label)))},_setEntityLongIdAttr:function(e){this._set("entityLongId",e),this._bookmarklet&&this._bookmarklet.set("disabled",-1===e),this._handles.forEach(function(e){e.remove()});var t=null,n=null,i="";if(e>-1&&this.itemsMap.hasOwnProperty(String(e))&&(i=this._getIconClass(h.getEntityTypeIndex(e)),t=(n=this.itemsMap[String(e)]).label),this._heading){for(this._iconNode.className=i;this._heading&&this._heading.firstChild;)this._heading.removeChild(this._heading.firstChild);null!==t&&this._heading.appendChild(document.createTextNode(t)),this._externalLink.setAttribute("disabled",null===t),this.set("label",t)}this._viewerWrapper&&this._viewerWrapper.set("selectedItem",n),this._selectedItem=n,this.layout()}}),ue=M([v,Y],{baseClass:"extension modelexplorer",frameworkServices:null,gutters:!0,modelDataLoader:null,pasteSpecial:null,postCreate:function(){this.inherited(arguments),this.addChild(new O({region:"center",content:'<div class="circles-loader__container"><div class="circles-loader"><div class="circles-loader__discs"><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,64 C49.673112,64 64,49.673112 64,32 C64,14.326888 49.673112,0 32,0 C14.326888,0 0,14.326888 0,32 C0,49.673112 14.326888,64 32,64 Z M32,60 C47.463973,60 60,47.463973 60,32 C60,16.536027 47.463973,4 32,4 C16.536027,4 4,16.536027 4,32 C4,47.463973 16.536027,60 32,60 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg><svg class="circles-loader__shape" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32,0 C14.326888,0 0,14.326888 0,32 C0,32.6394653 0.0187568455,33.2745497 0.0557503724,33.9047331 C0.184632347,34.6942808 0.611302752,36.0226237 2.0234375,36.0226237 C4.03271484,36.0226237 4,33.3333333 4,33.3333333 L4.03118694,33.3333333 C4.01047298,32.8914897 4,32.4469679 4,32 C4,16.536027 16.536027,4 32,4 L32,3.93294271 C32,3.93294271 34.750651,3.95442708 34.6666667,2 C34.750651,0.06640625 32,0.0621744792 32,0.0621744792 L32,-3.6429193e-16 Z" id="Combined-Shape" stroke="none" fill="#14abe9" fill-rule="evenodd"></path></svg></div></div>'}))},startup:function(){this.inherited(arguments),this.modelDataLoader.load().then(function(){var e=(new Date).getTime();this._renderUI(this.modelDataLoader),console.log("rendered",(new Date).getTime()-e+"ms")}.bind(this),function(e){console.log(e)})},_renderUI:function(e){this.removeChild(this.getChildren()[0]);var t=new P({region:"top",style:"height:45%",splitter:!0}),n=new re({containerId:t.id,frameworkServices:this.frameworkServices,modelDataLoader:e,region:"top",style:"height:26px;"});this.addChild(n),t.addChild(new ne({hierarchies:e.get("hierarchies")})),t.addChild(new ie({modules:e.get("modules")})),t.addChild(new te({dashboards:e.get("dashboards")})),t.addChild(new ee({actions:e.get("actions")})),t.addChild(new oe({sources:e.get("importDataSources")})),this.addChild(t);var o=["actions","dashboards","modules","hierarchies","importDataSources"].map(function(t){return e.get(t)}).reduce(function(e,t){return t.forEach(function(t){e[String(t.entityLongId)]=t}),e},{}),r=new de({itemsMap:o,region:"center"});this.addChild(r),t.getChildren().forEach(function(e){this.own(e.on("select",function(e){r.set("entityLongId",e)}.bind(this)))}.bind(this)),this.own(n.on("query",function(e){var n,o=e.id,r=Number(o),a=(e.label,function(e){return e.entityLongId===r});switch(h.getEntityTypeIndex(r)){case i.MODULE_ENTITY_TYPE_INDEX:n=function(e){return e.entityLongId===r||Array.isArray(e.referencedInAppliesTo)&&e.referencedInAppliesTo.some(a)||Array.isArray(e.usedModules)&&e.usedModules.some(a)};break;case i.HIERARCHY_ENTITY_TYPE_INDEX:case i.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX:n=function(e){return e.entityLongId===r||Array.isArray(e._fullAppliesTo)&&e._fullAppliesTo.indexOf(r)>-1||Array.isArray(e.referencedAsFormat)&&e.referencedAsFormat.some(a)||Array.isArray(e.subsets)&&e.subsets.some(a)};break;case i.ACTION_ENTITY_TYPE_INDEX:case i.PROCESS_ENTITY_TYPE_INDEX:case i.IMPORT_ENTITY_TYPE_INDEX:n=function(e){return e.entityLongId===r||Array.isArray(e.actions)&&e.actions.some(a)||Array.isArray(e.usedInProcesses)&&e.usedInProcesses.some(a)||Array.isArray(e.imports)&&e.imports.some(a)};break;case i.DASHBOARD_ENTITY_TYPE_INDEX:n=function(e){return e.entityLongId===r||Array.isArray(e.usedInDashboards)&&e.usedInDashboards.some(a)};break;case i.IMPORT_DATA_SOURCE_ENTITY_TYPE_INDEX:n=function(e){return e.entityLongId===r};break;default:n=function(e){return e.id===r||e.referencedBy&&e.referencedBy.map(function(e){return e?e.id:-1}).indexOf(r)>-1||e.refersTo&&e.refersTo.map(function(e){return e?e.id:-1}).indexOf(r)>-1}}t.selectedChildWidget.setQuery(n)})),this.own(n.on("cancel",function(){t.selectedChildWidget.setQuery(null)})),this.own(r.on("navigate",function(e){this.emit("navigate",e)}.bind(this)))}}),ce=M([B,Y,N],{frameworkServices:null,title:"Model Explorer",destroy:function(){this._main&&this._main.destroyRecursive()},show:function(e){var t,n=new Q({});e?(t=new ue({frameworkServices:this.frameworkServices,modelDataLoader:n,title:this.title}),this.frameworkServices.showAsPopup(t)):(t=new ue({frameworkServices:this.frameworkServices,modelDataLoader:n,region:"center",title:this.title}),this.frameworkServices.showInSitu(t)),this.own(t.on("navigate",function(e){this.emit("navigate",e)}.bind(this))),this._main=t}});D.byId("framework").register(new ce({}))});
