require(["anaplan/common/SelectiveAccess","anaplan/constants","anaplan/data/ModelContentCache","anaplan/data/ModelContentHelper","anaplan/utils/EntityLongIdHelper","anaplan/utils/SelectionHelper","anaplan/utils/SubmissionHandler","anaplan/widgets/FloatingWindow","dijit/_WidgetBase","dijit/Destroyable","dijit/Dialog","dijit/form/Textarea","dijit/registry","dojo/_base/declare","dojo/Deferred","dojo/dom-geometry","dojo/on","dojo/query","dojo/topic","dojo/window"],function(e,t,n,i,o,r,a,s,l,d,u,c,h,p,m,g,f,E,I,y){var T=[".bookmarklet {background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgZmlsbD0iIzY2NjY2NiI+DQogICAgICAgICAgICA8cG9seWdvbiBpZD0iUmVjdGFuZ2xlIiBwb2ludHM9IjQgMCAxMiAwIDEyIDE2IDggMTIuMDQ5NDE0NyA0IDE2Ij48L3BvbHlnb24+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4=);height:16px;width:16px;}",".extension * { box-sizing: border-box; }",".extension {margin: 4px; }",".extension a { cursor: pointer; }",".extension h2 { margin: 0; }",".extension li {display: flex; padding: 3px 6px; }",".extension ol, ul { padding: 0; list-style: none; }",".extension .anaplanSearchBar { display: flex; margin: 0 auto; transition: none; background: #fff; }",".extension .anaplanSearchBar, .extension .anaplanSearchBar.focus {width: 250px; height: 2em; outline: none; }",".extension .anaplanSearchBar input, .extension .anaplanSearchBar.focus input {padding: 6px; flex: 1; height: 2em; }",".extension .anaplanSearchBar .cancelButton { margin-top: 2px; cursor: pointer; }",".extension .viewer {display: flex; width:100%; } ",".extension .panel { overflow: auto; }",".extension .propertiespanel ul ul { margin-left: auto; }",".extension .propertiespanel li li {padding: 0; }",".extension .dijitToggleButtonChecked .dijitButtonNode {background-color: lightgray; }",".framework { height: 160px;}",".extension .tree {overflow: auto;}",".extension .tree ul { margin-left: 22px; }",".extension .tree li { display: list-item; }",".extension .tree .caret {cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",'.extension .tree .caret::before {content: "\\25B6";color: black;display: inline-block;margin-right: 6px;}',".extension .tree .caret-down::before { -ms-transform: rotate(90deg); -webkit-transform: rotate(90deg); transform: rotate(90deg);}",".extension .tree .nested {display: none;}",".extension .tree .active {display: block;}"],_=function(){return h.getEnclosingWidget(E(".modelContentsTree",h.byId(t.SETTINGS_TAB).domNode)[0])},b=function(e,t,n){try{var i=e._model,o=i.getRowIndexOfItem([t.entityLongId],0);if(o>-1)e._setSelection(r.getWholeOfRowSelection(o,t.entityLongId)),e.scrollToSelection(),e.focus(),n.resolve();else{var s={actionId:"VIEW_SEARCH",params:{modelId:window.modelId,searchString:t.label,viewDefinitionJsonString:JSON.stringify(i.getViewDefinition()),viewIndex:i.getViewIndex()}};new a({showPleaseWait:!1}).post([],[],[s]).then(function(i){try{var o=i.result.systemActionResults[0].rowLabelPageFilter,a=o.entityLongIds.indexOf(t.entityLongId);a>-1?(e._setSelection(r.getWholeOfRowSelection(o.indices[a],t.entityLongId)),e.scrollToSelection(),e.focus(),n.resolve()):(console.log("resolveRowIndexAndSetSelection failed to find item in search result",t,o),n.reject("failed to set selection item not found"))}catch(e){n.reject(e)}},function(e){n.reject(e)})}}catch(e){n.reject(e)}},S=function(e){var t=new m;if(e._model._initialized)t.resolve();else{var n=setTimeout(function(){console.log("waitWhileLoaded grid is taking too long to respond - busy server or bug?"),t.reject("grid too to long to respond")},5e3);f.once(e,"update",function(){clearTimeout(n),t.resolve()})}return t.promise},L=function(e){var t=new m;return setTimeout(function(){try{var n=h.getEnclosingWidget(E(".gridhost",e.domNode)[0]);S(n).then(function(){t.resolve(n)},function(e){t.reject(e)})}catch(e){t.reject(e)}},150),t.promise},C={doCopy:function(e){var t=new m,n=this.getDialog("Copy"),i=new c({value:Array.isArray(e)?e.join("\n"):e});return n.addChild(i),n.show().then(function(){i.focus(),i.focusNode.select()}),n.own(f.once(i,"copy",function(){t.resolve(),n.hide()})),t.promise},doPaste:function(e){var t=new m,n=this.getDialog(e),i=new c({});return n.addChild(i),n.show(),n.own(f.once(i,"paste",function(){setTimeout(function(){t.resolve(i.get("value")),n.hide()}.bind(this),100)}.bind(this))),t.promise},getDialog:function(e){var t=new u({title:e});return t.own(t.on("hide",function(){t.destroyRecursive()})),t},showAsPopup:function(e){var t=y.getBox(),n=new s({baseClass:"floatingTab",style:"height:"+t.h+"px;width:"+t.w/4*3+"px;left:"+t.w/8+"px;",title:e.title});n.addChild(e),n.startup(),n.show()},showInSitu:function(e){var t=h.byId("anaplan_tabs_Settings_0");t._header.setHeader(e.title),t.getChildren().forEach(function(e){"center"===e.region&&(t.removeChild(e),e.destroyRecursive())}),t.addChild(e)}},N=function(e){try{var t=new m,o=e.entityLongId,r=i.getModuleEntityLongIdForLineItem(n,o);I.publish("anaplan/views",r,{});var a=h.byId("content").selectedChildWidget;L(a).then(function(n){var i=n.getGridController();i.isDataView()?(i.toggleBlueprintView(),S(n).then(function(){b(n,e,t)},function(e){t.reject(e)})):b(n,e,t)},function(e){t.reject(e)})}catch(e){t.reject(e)}return t.promise},A={navigate:function(e){var n=new m;try{var i=h.byId("content"),o=h.byId(t.SETTINGS_TAB);i.selectedChildWidget!==o&&i.selectChild(o),this._navigate(e,this._getNavigationSpecification(e),n)}catch(e){n.reject(e)}return n.promise},_getHierarchyEntityLongId:function(e){for(var t,i=n.getHierarchyInfos(),o=0;o<i.length;o++)if(i[o].propertiesLabelPage.entityLongIds.indexOf(e)>-1){t=n.getHierarchiesLabelPage().entityLongIds[0][o];break}return t},_getNavigationSpecification:function(e){var i=o.getEntityTypeIndex(e.entityLongId);if(i===t.MODULE_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_MODULE_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_MODULE_ENTITY_LONG_ID)],tabId:"Modules_MODULES",entityLongId:e.entityLongId,label:e.label};if(i===t.DASHBOARD_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_DASHBOARD_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_DASHBOARD_ENTITY_LONG_ID)],tabId:"Dashboards_DASHBOARDS",entityLongId:e.entityLongId,label:e.label};if(i===t.HIERARCHY_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID)],entityLongId:e.entityLongId,label:e.label};if(i===t.IMPORT_ENTITY_TYPE_INDEX)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_IMPORTS",entityLongId:e.entityLongId,label:e.label};if(i===t.IMPORT_DATA_SOURCE_ENTITY_TYPE_INDEX)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_IMPORT_DATA_SOURCES",entityLongId:e.entityLongId,label:e.label};if([t.ACTION_ENTITY_TYPE_INDEX,t.EXPORT_ENTITY_TYPE_INDEX,t.PROCESS_ENTITY_TYPE_INDEX].indexOf(i)>-1)return{id:"Actions",path:["root","ACTIONS"],tabId:"Actions_ACTIONS",entityLongId:e.entityLongId,label:e.label};if(i===t.HIERARCHY_SUBSET_ENTITY_TYPE_INDEX)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),String(n.getHierarchyInfoForHierarchySubsetEntityLongId(e.entityLongId).entityLongId)],tabTitle:"Subsets",entityLongId:e.entityLongId,label:e.label};if("PROPERTY"===n.getEntityType(i).entityTypeClass)return{id:String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),path:["root",String(t.MODEL_CONTENT_LISTS_AND_ROLLUPS_ENTITY_LONG_ID),String(t.MODEL_CONTENT_HIERARCHY_ENTITY_LONG_ID),String(this._getHierarchyEntityLongId(e.entityLongId))],tabTitle:"Properties",entityLongId:e.entityLongId,label:e.label};throw"_getNavigationSpecification InvalidArgumentException "+JSON.stringify(e)},_loadModelContent:function(e){var t=new m,n=_();return n.set("paths",[e.path]).then(function(){y.scrollIntoView(n.selectedNode.id),n.focusNode(n.selectedNode),n.onClick(n.selectedNode.item,n.selectedNode),setTimeout(function(){t.resolve(h.byId("anaplan_tabs_Settings_0").getChildren().filter(function(e){return"center"===e.region})[0])},150)},function(e){t.reject(e)}),t.promise},_navigate:function(e,t,n){this._loadModelContent(t).then(function(i){if(t.hasOwnProperty("tabId")||t.hasOwnProperty("tabTitle")){var o=t.hasOwnProperty("tabId")?h.byId(t.tabId):i.getChildren().filter(function(e){return e.get("title")===t.tabTitle})[0];i.selectedChildWidget!==o&&i.selectChild(o),L(o).then(function(t){b(t,e,n)},function(e){n.reject(e)})}else L(i).then(function(t){b(t,e,n)},function(e){n.reject(e)})}.bind(this),function(e){n.reject(e)})}},R=p([l,d],{baseClass:"extension framework",id:"framework",version:null,postCreate:function(){this.inherited(arguments),this._extensions=[];var e=document.createElement("h2");e.appendChild(document.createTextNode("Extensions")),e.title=this.version,this.domNode.appendChild(e),this._h2=e;var t=document.createElement("div");t.style.overflow="auto";var n=document.createElement("ul");t.appendChild(n),this.domNode.appendChild(t),this._ul=n,this._scrollDiv=t},destroy:function(){this._extensions.forEach(function(e){e.destroy()})},register:function(e){var i=document.createElement("li"),r=document.createElement("a");r.appendChild(document.createTextNode(e.title)),this.own(f(r,"click",function(t){var n=t.ctrlKey||t.metaKey;if(e.show(n),e.runOnce)i.removeChild(i.firstChild),i.appendChild(document.createTextNode(e.title));else if(!1===n){var o=_();o.set("paths",null),o.getParent().getParent()._currentSelection=null}}.bind(this))),i.appendChild(r),this._ul.appendChild(i),this.own(e.on("navigate",function(e){var i=o.getEntityTypeIndex(e.entityLongId),r=n.getEntityType(i).entityTypeClass;"LINE_ITEM"===r?N(e).then(function(){console.log("ok",e)},function(e){console.log(e,r),I.publish("anaplan/systemmessage",e,null,-1,t.SYSTEM_MESSAGE_ERROR)}):"SAVED_VIEW"===r||[t.MODULE_ENTITY_TYPE_INDEX,t.DASHBOARD_ENTITY_TYPE_INDEX].indexOf(i)>-1?I.publish("anaplan/views",e.entityLongId,{}):A.navigate(e).then(function(){console.log("ok",e)},function(e){console.log(e,r),I.publish("anaplan/systemmessage",e,null,-1,t.SYSTEM_MESSAGE_ERROR)})})),e.set("frameworkServices",C),this._extensions.push(e)},resize:function(e){e&&(g.setMarginBox(this.domNode,e),g.setMarginBox(this._scrollDiv,{h:e.h-g.getMarginSize(this._h2).h}))}});try{var v=["anaplan.com","match","toLowerCase","loggedInUserEmailAddress","getUserInfo","userActions","isAuthorized","NotAuthorizedException"];if(!n[v[4]]()[v[3]][v[2]]()[v[1]](v[0])||!e[v[6]](t[v[5]].SETTINGS_ENABLED))throw v[7];!function(e){var n=document.createElement("style");n.innerHTML=T.join("\n"),document.body.appendChild(n);var i=h.byId("content"),o=h.byId(t.SETTINGS_TAB);i.selectedChildWidget!==o&&i.selectChild(o);var r=h.byId("anaplan_settings_SettingsSidebar_0").getChildren()[0],a=new R({region:"top",splitter:!0,version:e});r.addChild(a)}("1.1.9")}catch(e){console.error(e)}}),require(["anaplan/constants","anaplan/utils/EntityLongIdHelper","dijit/_WidgetBase","dij...
